"use strict";(self.webpackChunkmuse_dashboard=self.webpackChunkmuse_dashboard||[]).push([[742],{4742:(e,t,a)=>{a.r(t),a.d(t,{default:()=>te});var l=a(9950),r=a(6025),s=a(2460),i=a(3561),n=a(7094),o=a(1988),d=a(5355),c=a(6004),u=a(7465),h=a(9654),m=a(5621),x=a(6550),p=a(8864),g=a(2748),A=a(2077),y=a(5376),k=a(6092),j=a(1967),v=a(3911),f=a(2678),_=a(9246),w=a(9051),b=a.n(w),Y=a(2056),$=a(7293),S=a(9949),I=a(4209),B=a(9185),D=a(2098),z=a(7379),M=a(7109),T=a(4414);const C=()=>{const[e,t]=(0,l.useState)(null),[a,r]=(0,l.useState)(!0);(0,l.useEffect)((()=>{s()}),[]);const s=async()=>{try{console.log("Fetching statistics...");const e=await _.A.get("http://localhost:5001/api/workflow/statistics",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});console.log("Statistics response:",e.data),e.data&&t(e.data)}catch(a){var e;console.error("Error fetching statistics:",(null===(e=a.response)||void 0===e?void 0:e.data)||a),message.error("\u0130statistikler y\xfcklenirken bir hata olu\u015ftu")}finally{r(!1)}};return a?(0,T.jsx)(y.A,{size:"large"}):(0,T.jsxs)(n.A,{gutter:[16,16],style:{marginBottom:24},children:[(0,T.jsx)(o.A,{xs:24,sm:12,lg:6,children:(0,T.jsx)(Y.A,{hoverable:!0,children:(0,T.jsx)($.A,{title:"Toplam G\xf6revler",value:(null===e||void 0===e?void 0:e.total_tasks)||0,prefix:(0,T.jsx)(S.A,{}),valueStyle:{color:"#1890ff"}})})}),(0,T.jsx)(o.A,{xs:24,sm:12,lg:6,children:(0,T.jsx)(Y.A,{hoverable:!0,children:(0,T.jsx)($.A,{title:"Tamamlanan G\xf6revler",value:(null===e||void 0===e?void 0:e.completed_tasks)||0,prefix:(0,T.jsx)(j.A,{}),valueStyle:{color:"#52c41a"},suffix:(0,T.jsx)(g.A,{title:"Tamamlanma Oran\u0131",children:null!==e&&void 0!==e&&e.total_tasks?` (${(e.completed_tasks/e.total_tasks*100).toFixed(1)}%)`:" (0%)"})})})}),(0,T.jsx)(o.A,{xs:24,sm:12,lg:6,children:(0,T.jsx)(Y.A,{hoverable:!0,children:(0,T.jsx)($.A,{title:"Bekleyen G\xf6revler",value:(null===e||void 0===e?void 0:e.pending_tasks)||0,prefix:(0,T.jsx)(I.A,{spin:!0}),valueStyle:{color:"#faad14"},suffix:(0,T.jsx)(g.A,{title:"Bekleyen Oran",children:null!==e&&void 0!==e&&e.total_tasks?` (${(e.pending_tasks/e.total_tasks*100).toFixed(1)}%)`:" (0%)"})})})}),(0,T.jsx)(o.A,{xs:24,sm:12,lg:6,children:(0,T.jsx)(Y.A,{hoverable:!0,children:(0,T.jsx)($.A,{title:"Y\xfcksek \xd6ncelikli",value:(null===e||void 0===e?void 0:e.high_priority_tasks)||0,prefix:(0,T.jsx)(B.A,{}),valueStyle:{color:"#ff4d4f"},suffix:(0,T.jsx)(g.A,{title:"Y\xfcksek \xd6ncelikli Oran",children:null!==e&&void 0!==e&&e.total_tasks?` (${(e.high_priority_tasks/e.total_tasks*100).toFixed(1)}%)`:" (0%)"})})})}),(0,T.jsx)(o.A,{xs:24,sm:12,lg:6,children:(0,T.jsx)(Y.A,{hoverable:!0,children:(0,T.jsx)(g.A,{title:"Tamamlanan g\xf6revlerin ortalama tamamlanma s\xfcresi",children:(0,T.jsx)($.A,{title:"Ort. Tamamlanma S\xfcresi",value:(null===e||void 0===e?void 0:e.avg_completion_days)||0,prefix:(0,T.jsx)(v.A,{}),valueStyle:{color:"#722ed1"},suffix:"g\xfcn",precision:1})})})}),(0,T.jsx)(o.A,{xs:24,sm:12,lg:6,children:(0,T.jsx)(Y.A,{hoverable:!0,children:(0,T.jsx)($.A,{title:"Bu Ay Tamamlanan",value:(null===e||void 0===e?void 0:e.completed_this_month)||0,prefix:(0,T.jsx)(D.A,{}),valueStyle:{color:"#13c2c2"}})})}),(0,T.jsx)(o.A,{xs:24,sm:12,lg:6,children:(0,T.jsx)(Y.A,{hoverable:!0,children:(0,T.jsx)($.A,{title:"Geciken G\xf6revler",value:(null===e||void 0===e?void 0:e.overdue_tasks)||0,prefix:(0,T.jsx)(z.A,{}),valueStyle:{color:"#f5222d"},suffix:(0,T.jsx)(g.A,{title:"Gecikme Oran\u0131",children:null!==e&&void 0!==e&&e.total_tasks?` (${(e.overdue_tasks/e.total_tasks*100).toFixed(1)}%)`:" (0%)"})})})}),(0,T.jsx)(o.A,{xs:24,sm:12,lg:6,children:(0,T.jsx)(Y.A,{hoverable:!0,children:(0,T.jsx)($.A,{title:"Ortalama \u0130lerleme",value:(null===e||void 0===e?void 0:e.avg_progress)||0,prefix:(0,T.jsx)(M.A,{}),valueStyle:{color:"#eb2f96"},suffix:"%",precision:1})})})]})};var G=a(5480),E=a(7984),F=a(9796),O=a(1203),R=a(5398),L=a(495),H=a(6823),P=a(6076),K=a(9378),q=a(1598),U=a(8114);const{Text:V}=G.A,{TextArea:J}=d.A,{Panel:N}=E.A,Q=e=>{let{author:t,content:a,datetime:l}=e;return(0,T.jsxs)("div",{style:{borderBottom:"1px solid #f0f0f0",padding:"16px 0"},children:[(0,T.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"8px"},children:[(0,T.jsx)(F.A,{icon:(0,T.jsx)(K.A,{})}),(0,T.jsx)(V,{strong:!0,style:{marginLeft:"8px"},children:t}),(0,T.jsx)(V,{type:"secondary",style:{marginLeft:"8px"},children:l})]}),(0,T.jsx)("div",{style:{marginLeft:"40px"},children:(0,T.jsx)(V,{children:a})})]})},W=e=>{let{taskId:t,subtaskId:a=null,title:r="Yap\u0131lacaklar Listesi"}=e;const[s,i]=(0,l.useState)([]),[n,o]=(0,l.useState)("");(0,l.useEffect)((()=>{t&&c()}),[t,a]);const c=async()=>{try{const e=await _.A.get(`http://localhost:5001/api/workflow/checklist/${t}${a?`/${a}`:""}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});i(e.data)}catch(e){console.error("Error fetching checklist items:",e),h.Ay.error("Yap\u0131lacaklar listesi y\xfcklenirken bir hata olu\u015ftu")}},x=async()=>{if(n.trim())try{const e=await _.A.post(`http://localhost:5001/api/workflow/checklist/${t}${a?`/${a}`:""}`,{description:n},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});i([...s,e.data]),o(""),h.Ay.success("Yap\u0131lacak i\u015f eklendi")}catch(e){console.error("Error adding checklist item:",e),h.Ay.error("Yap\u0131lacak i\u015f eklenirken bir hata olu\u015ftu")}};return(0,T.jsxs)("div",{children:[(0,T.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16,padding:"8px 0"},children:[(0,T.jsx)(V,{strong:!0,children:r}),(0,T.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,T.jsx)(m.A,{color:"blue",children:`${s.filter((e=>e.is_completed)).length}/${s.length}`}),(0,T.jsx)(p.A,{percent:(()=>{if(0===s.length)return 0;const e=s.filter((e=>e.is_completed)).length;return Math.round(e/s.length*100)})(),size:"small",style:{width:100,marginBottom:0}})]})]}),(0,T.jsxs)("div",{style:{marginBottom:16,display:"flex",gap:8},children:[(0,T.jsx)(d.A.TextArea,{placeholder:"Yeni yap\u0131lacak i\u015f ekle",value:n,onChange:e=>o(e.target.value),onPressEnter:e=>{e.preventDefault(),x()},autoSize:{minRows:1,maxRows:3},style:{flex:1}}),(0,T.jsx)(u.Ay,{type:"primary",onClick:x,children:"Ekle"})]}),0===s.length?(0,T.jsx)(O.A,{description:"Hen\xfcz yap\u0131lacak i\u015f eklenmemi\u015f",style:{margin:"20px 0"}}):(0,T.jsx)(R.A,{size:"small",dataSource:s,renderItem:e=>(0,T.jsx)(R.A.Item,{actions:[(0,T.jsx)(u.Ay,{type:"text",danger:!0,size:"small",onClick:()=>(async e=>{try{await _.A.delete(`http://localhost:5001/api/workflow/checklist/item/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),i(s.filter((t=>t.id!==e))),h.Ay.success("Yap\u0131lacak i\u015f silindi")}catch(t){console.error("Error deleting checklist item:",t),h.Ay.error("Yap\u0131lacak i\u015f silinirken bir hata olu\u015ftu")}})(e.id),children:"Sil"})],style:{backgroundColor:e.is_completed?"#f6ffed":"transparent",transition:"background-color 0.3s"},children:(0,T.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,flex:1},children:[(0,T.jsx)(L.A,{checked:e.is_completed,onChange:t=>(async(e,t)=>{try{await _.A.put(`http://localhost:5001/api/workflow/checklist/item/${e}`,{is_completed:t},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});const a=s.map((a=>a.id===e?{...a,is_completed:t}:a));i(a)}catch(a){console.error("Error updating checklist item:",a),h.Ay.error("Yap\u0131lacak i\u015f g\xfcncellenirken bir hata olu\u015ftu")}})(e.id,t.target.checked)}),(0,T.jsx)(V,{style:{textDecoration:e.is_completed?"line-through":"none",color:e.is_completed?"#8c8c8c":"inherit",flex:1},children:e.description}),e.completed_at&&(0,T.jsx)(m.A,{color:"green",style:{marginLeft:"auto"},children:b()(e.completed_at).format("DD.MM.YYYY")})]})})})]})},X=e=>{let{task:t,onUpdate:a}=e;const[c,x]=(0,l.useState)([]),[g,A]=(0,l.useState)([]),[y,k]=(0,l.useState)([]),[j,v]=(0,l.useState)([]),[f,w]=(0,l.useState)(""),[$,S]=(0,l.useState)(0),[I]=i.A.useForm(),[B,z]=(0,l.useState)(!1),[M]=i.A.useForm(),[C,G]=(0,l.useState)([]);(0,l.useEffect)((()=>{M.setFieldsValue({status:t.status,priority:t.priority,due_date:b()(t.due_date)})}),[t]),(0,l.useEffect)((()=>{null!==t&&void 0!==t&&t.id&&(O(),N(),X(),Z(),F())}),[null===t||void 0===t?void 0:t.id]);const F=async()=>{try{const e=await _.A.get("http://localhost:5001/api/personnel",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});G(e.data)}catch(e){console.error("Personel listesi al\u0131n\u0131rken hata olu\u015ftu:",e),h.Ay.error("Personel listesi y\xfcklenirken bir hata olu\u015ftu")}},O=async()=>{try{const e=await _.A.get(`http://localhost:5001/api/workflow/tasks/${t.id}/comments`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});x(e.data)}catch(e){console.error("Yorumlar al\u0131n\u0131rken hata olu\u015ftu:",e),h.Ay.error("Yorumlar y\xfcklenirken bir hata olu\u015ftu")}},N=async()=>{try{const e=await _.A.get(`http://localhost:5001/api/workflow/tasks/${t.id}/history`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});A(e.data)}catch(e){console.error("Ge\xe7mi\u015f al\u0131n\u0131rken hata olu\u015ftu:",e),h.Ay.error("G\xf6rev ge\xe7mi\u015fi y\xfcklenirken bir hata olu\u015ftu")}},X=async()=>{try{const e=await _.A.get(`http://localhost:5001/api/workflow/tasks/${t.id}/subtasks`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});console.log("Fetched Subtasks:",e.data),k(e.data),ee(e.data)}catch(e){console.error("Alt g\xf6revler al\u0131n\u0131rken hata olu\u015ftu:",e),h.Ay.error("Alt g\xf6revler y\xfcklenirken bir hata olu\u015ftu")}},Z=async()=>{try{const e=await _.A.get(`http://localhost:5001/api/workflow/tasks/${t.id}/attachments`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});v(e.data)}catch(e){console.error("Ekler al\u0131n\u0131rken hata olu\u015ftu:",e),h.Ay.error("Ekler y\xfcklenirken bir hata olu\u015ftu")}},ee=e=>{if(0===e.length)return;const t=e.filter((e=>"completed"===e.status)).length,a=t/e.length*100;S(a)},te=async()=>{if(f.trim())try{await _.A.post(`http://localhost:5001/api/workflow/tasks/${t.id}/subtasks`,{description:f,status:"pending"},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),w(""),X(),N(),h.Ay.success("Alt g\xf6rev eklendi")}catch(e){console.error("Alt g\xf6rev eklenirken hata olu\u015ftu:",e),h.Ay.error("Alt g\xf6rev eklenirken bir hata olu\u015ftu")}},ae=async(e,a)=>{try{await _.A.put(`http://localhost:5001/api/workflow/tasks/${t.id}/subtasks/${e}`,a,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),X(),h.Ay.success("Alt g\xf6rev g\xfcncellendi")}catch(l){console.error("Alt g\xf6rev g\xfcncellenirken hata olu\u015ftu:",l),h.Ay.error("Alt g\xf6rev g\xfcncellenirken bir hata olu\u015ftu")}},le={name:"file",action:`http://localhost:5001/api/workflow/tasks/${t.id}/attachments`,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},beforeUpload:e=>!!(e.size<=10485760)||(h.Ay.error("Dosya boyutu 10MB'dan k\xfc\xe7\xfck olmal\u0131d\u0131r!"),!1),onChange:async e=>{"uploading"!==e.file.status?"done"===e.file.status?(z(!1),h.Ay.success(`${e.file.name} ba\u015far\u0131yla y\xfcklendi`),await Z()):"error"===e.file.status&&(z(!1),h.Ay.error(`${e.file.name} y\xfcklenirken hata olu\u015ftu`)):z(!0)},multiple:!1};return(0,T.jsxs)("div",{children:[(0,T.jsx)(Y.A,{title:"Alt G\xf6rev \u0130lerlemesi",style:{marginBottom:16},children:(0,T.jsx)(p.A,{percent:$,status:"active",strokeColor:{"0%":"#108ee9","100%":"#87d068"}})}),(0,T.jsx)(Y.A,{title:"G\xf6rev Durumu",style:{marginBottom:16},children:(0,T.jsxs)(i.A,{form:M,layout:"vertical",onFinish:async e=>{try{await _.A.put(`http://localhost:5001/api/workflow/tasks/${t.id}`,{...t,...e,due_date:e.due_date.format("YYYY-MM-DD")},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),h.Ay.success("G\xf6rev ba\u015far\u0131yla g\xfcncellendi"),null===a||void 0===a||a(),N(),M.setFieldsValue({status:e.status,priority:e.priority,due_date:b()(e.due_date)})}catch(l){console.error("G\xf6rev g\xfcncellenirken hata olu\u015ftu:",l),h.Ay.error("G\xf6rev g\xfcncellenirken bir hata olu\u015ftu")}},children:[(0,T.jsxs)(n.A,{gutter:16,children:[(0,T.jsx)(o.A,{span:8,children:(0,T.jsx)(i.A.Item,{name:"status",label:"Durum",rules:[{required:!0,message:"Durum se\xe7iniz"}],children:(0,T.jsxs)(r.A,{children:[(0,T.jsx)(r.A.Option,{value:"pending",children:"Beklemede"}),(0,T.jsx)(r.A.Option,{value:"completed",children:"Tamamland\u0131"})]})})}),(0,T.jsx)(o.A,{span:8,children:(0,T.jsx)(i.A.Item,{name:"priority",label:"\xd6ncelik",rules:[{required:!0,message:"\xd6ncelik se\xe7iniz"}],children:(0,T.jsxs)(r.A,{children:[(0,T.jsx)(r.A.Option,{value:"High",children:"Y\xfcksek"}),(0,T.jsx)(r.A.Option,{value:"Medium",children:"Orta"}),(0,T.jsx)(r.A.Option,{value:"Low",children:"D\xfc\u015f\xfck"})]})})}),(0,T.jsx)(o.A,{span:8,children:(0,T.jsx)(i.A.Item,{name:"due_date",label:"Biti\u015f Tarihi",rules:[{required:!0,message:"Tarih se\xe7iniz"}],children:(0,T.jsx)(s.A,{style:{width:"100%"}})})})]}),(0,T.jsx)(i.A.Item,{children:(0,T.jsx)(u.Ay,{type:"primary",htmlType:"submit",children:"G\xfcncelle"})})]})}),(0,T.jsx)(Y.A,{title:"G\xf6rev Yap\u0131lacaklar Listesi",style:{marginBottom:16},children:(0,T.jsx)(W,{taskId:t.id,title:"G\xf6rev Yap\u0131lacaklar"})}),(0,T.jsxs)(Y.A,{title:"Alt G\xf6revler ve Yap\u0131lacaklar",style:{marginBottom:16},children:[(0,T.jsx)(R.A,{dataSource:y,renderItem:e=>(0,T.jsxs)("div",{style:{marginBottom:24},children:[(0,T.jsx)(R.A.Item,{actions:[(0,T.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,T.jsx)(r.A,{placeholder:"Ki\u015fi ata",value:e.assigned_to,style:{width:150},onChange:t=>ae(e.id,{assigned_to:t}),allowClear:!0,children:C.map((e=>(0,T.jsx)(r.A.Option,{value:e.id,children:`${e.first_name} ${e.last_name}`},e.id)))}),(0,T.jsx)(s.A,{placeholder:"Biti\u015f tarihi",value:e.due_date?b()(e.due_date):null,onChange:t=>ae(e.id,{due_date:t?t.format("YYYY-MM-DD"):null}),style:{width:130}})]})],children:(0,T.jsx)(L.A,{checked:"completed"===e.status,onChange:a=>(async(e,a)=>{try{await _.A.put(`http://localhost:5001/api/workflow/tasks/${t.id}/subtasks/${e}`,{status:a?"completed":"pending",description:"Alt g\xf6rev "+(a?"tamamland\u0131":"beklemeye al\u0131nd\u0131")},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),X(),N()}catch(l){console.error("Alt g\xf6rev g\xfcncellenirken hata olu\u015ftu:",l),h.Ay.error("Alt g\xf6rev g\xfcncellenirken bir hata olu\u015ftu")}})(e.id,a.target.checked),children:(0,T.jsxs)(V,{style:{textDecoration:"completed"===e.status?"line-through":"none",color:"completed"===e.status?"#8c8c8c":"inherit"},children:[e.description,e.assigned_to_name&&(0,T.jsx)(m.A,{color:"blue",style:{marginLeft:8},children:e.assigned_to_name}),e.due_date&&(0,T.jsx)(m.A,{color:"orange",style:{marginLeft:8},children:b()(e.due_date).format("DD.MM.YYYY")})]})})}),(0,T.jsx)("div",{style:{marginLeft:40,marginTop:8,padding:16,backgroundColor:"#fafafa",borderRadius:8},children:(0,T.jsx)(W,{taskId:t.id,subtaskId:e.id,title:`${e.description} - Yap\u0131lacaklar`})})]})}),(0,T.jsxs)("div",{style:{marginTop:16,display:"flex",gap:8},children:[(0,T.jsx)(d.A,{placeholder:"Yeni alt g\xf6rev ekle",value:f,onChange:e=>w(e.target.value),onPressEnter:te,style:{flex:1}}),(0,T.jsx)(u.Ay,{type:"primary",onClick:te,children:"Alt G\xf6rev Ekle"})]})]}),(0,T.jsx)(Y.A,{style:{marginBottom:16},children:(0,T.jsx)(E.A,{defaultActiveKey:[],children:(0,T.jsx)(E.A.Panel,{header:(0,T.jsxs)("span",{style:{display:"flex",alignItems:"center",color:"#1890ff"},children:[(0,T.jsx)(q.A,{style:{marginRight:8}}),"Dosyalar"]}),children:(0,T.jsxs)("div",{style:{padding:"16px 0"},children:[(0,T.jsx)(H.A,{...le,children:(0,T.jsx)(u.Ay,{icon:(0,T.jsx)(q.A,{}),loading:B,children:"Dosya Y\xfckle"})}),(0,T.jsx)(R.A,{style:{marginTop:16},dataSource:j,renderItem:e=>(0,T.jsx)(R.A.Item,{actions:[(0,T.jsx)(u.Ay,{type:"link",onClick:()=>window.open(`http://localhost:5001/uploads${e.file_path}`,"_blank"),icon:(0,T.jsx)(U.A,{}),children:"\u0130ndir"})],children:(0,T.jsx)(R.A.Item.Meta,{title:e.file_name,description:(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("div",{children:["Y\xfckleyen: ",e.uploaded_by_name]}),(0,T.jsxs)("div",{children:["Boyut: ",(e.file_size/1024).toFixed(2)," KB"]}),(0,T.jsxs)("div",{children:["Tarih: ",b()(e.uploaded_at).format("DD.MM.YYYY HH:mm")]})]})})})})]})},"1")})}),(0,T.jsx)(Y.A,{style:{marginBottom:16},children:(0,T.jsx)(E.A,{defaultActiveKey:[],children:(0,T.jsx)(E.A.Panel,{header:(0,T.jsxs)("span",{style:{display:"flex",alignItems:"center",color:"#1890ff"},children:[(0,T.jsx)(K.A,{style:{marginRight:8}}),"Yorumlar"]}),children:(0,T.jsxs)("div",{style:{padding:"16px 0"},children:[(0,T.jsxs)(i.A,{form:I,onFinish:async e=>{try{await _.A.post(`http://localhost:5001/api/workflow/tasks/${t.id}/comments`,{comment:e.comment},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),h.Ay.success("Yorum ba\u015far\u0131yla eklendi"),I.resetFields(),O()}catch(a){console.error("Yorum eklenirken hata olu\u015ftu:",a),h.Ay.error("Yorum eklenirken bir hata olu\u015ftu")}},layout:"vertical",children:[(0,T.jsx)(i.A.Item,{name:"comment",rules:[{required:!0,message:"L\xfctfen bir yorum yaz\u0131n"}],children:(0,T.jsx)(J,{rows:4,placeholder:"Yorumunuzu buraya yaz\u0131n..."})}),(0,T.jsx)(i.A.Item,{children:(0,T.jsx)(u.Ay,{type:"primary",htmlType:"submit",children:"Yorum Ekle"})})]}),(0,T.jsx)(R.A,{dataSource:c,renderItem:e=>(0,T.jsx)(Q,{author:e.created_by_name,content:e.comment,datetime:b()(e.created_at).format("DD.MM.YYYY HH:mm")}),locale:{emptyText:"Hen\xfcz yorum yap\u0131lmam\u0131\u015f"}})]})},"1")})}),(0,T.jsx)(Y.A,{style:{marginBottom:16},children:(0,T.jsx)(E.A,{defaultActiveKey:[],children:(0,T.jsx)(E.A.Panel,{header:(0,T.jsxs)("span",{style:{display:"flex",alignItems:"center",color:"#1890ff"},children:[(0,T.jsx)(D.A,{style:{marginRight:8}}),"G\xf6rev Ge\xe7mi\u015fi"]}),children:(0,T.jsx)(P.A,{style:{marginTop:16,marginBottom:16,padding:"0 16px"},items:g.map(((e,t)=>({key:t,color:"completed"===e.new_status?"green":"blue",children:(0,T.jsxs)(T.Fragment,{children:[e.description?(0,T.jsx)(V,{children:e.description}):(0,T.jsxs)(V,{children:["Durum "," ",(0,T.jsx)(V,{type:"secondary",children:e.old_status})," ","durumundan"," ",(0,T.jsx)(V,{strong:!0,children:e.new_status})," ","durumuna de\u011fi\u015ftirildi"]}),(0,T.jsx)("br",{}),(0,T.jsxs)(V,{type:"secondary",children:[e.changed_by_name," taraf\u0131ndan",(0,T.jsx)("br",{}),b()(e.changed_at).format("DD.MM.YYYY HH:mm")]})]})})))})},"1")})})]})},{Option:Z}=r.A,{RangePicker:ee}=s.A,te=()=>{const[e,t]=(0,l.useState)([]),[a,w]=(0,l.useState)({}),[Y,$]=(0,l.useState)([]),[S,I]=(0,l.useState)(!0),[B,D]=(0,l.useState)(!1),[z,M]=(0,l.useState)(null),[G,E]=(0,l.useState)({priority:"all",status:"all",dateRange:null,search:""}),[F]=i.A.useForm(),[O,R]=(0,l.useState)(null),[L,H]=(0,l.useState)(!1),[P,K]=(0,l.useState)(0),q=async()=>{I(!0);try{const e=[];"all"!==G.priority&&e.push(`priority=${G.priority}`),"all"!==G.status&&e.push(`status=${G.status}`),G.dateRange&&(e.push(`startDate=${G.dateRange[0].format("YYYY-MM-DD")}`),e.push(`endDate=${G.dateRange[1].format("YYYY-MM-DD")}`)),G.search&&e.push(`search=${G.search}`);const a=e.length?`?${e.join("&")}`:"",l=await _.A.get(`http://localhost:5001/api/workflow/tasks${a}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});t(l.data);const r=l.data.map((e=>_.A.get(`http://localhost:5001/api/workflow/tasks/${e.id}/subtasks`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}))),s=await Promise.all(r),i={};l.data.forEach(((e,t)=>{i[e.id]=s[t].data})),w(i)}catch(e){console.error("Error fetching tasks:",e),h.Ay.error("G\xf6revler y\xfcklenirken bir hata olu\u015ftu")}finally{I(!1)}},U=e=>{const t=a[e]||[];if(0===t.length)return null;const l=t.filter((e=>"completed"===e.status)).length;return{total:t.length,completed:l,percentage:Math.round(l/t.length*100)}};(0,l.useEffect)((()=>{q()}),[G]);const V=[{title:"G\xf6rev A\xe7\u0131klamas\u0131",dataIndex:"description",key:"description",render:(e,t)=>(0,T.jsxs)(c.A,{direction:"vertical",size:0,children:[(0,T.jsx)("span",{children:e}),U(t.id)&&(0,T.jsx)(p.A,{percent:U(t.id).percentage,size:"small",style:{marginTop:8,width:120}})]})},{title:"Alt G\xf6revler",key:"subtasks",width:120,render:(e,t)=>{const a=U(t.id);return a?(0,T.jsx)(g.A,{title:`${a.completed}/${a.total} tamamland\u0131`,children:(0,T.jsx)(A.A,{count:a.total,style:{backgroundColor:100===a.percentage?"#52c41a":"#1890ff"}})}):"-"}},{title:"Atanan Ki\u015fi",dataIndex:"assigned_to_name",key:"assigned_to_name"},{title:"Biti\u015f Tarihi",dataIndex:"due_date",key:"due_date",render:e=>b()(e).format("DD.MM.YYYY"),sorter:(e,t)=>b()(e.due_date).unix()-b()(t.due_date).unix()},{title:"\xd6ncelik",dataIndex:"priority",key:"priority",render:e=>(0,T.jsx)(m.A,{color:"High"===e?"red":"Medium"===e?"orange":"blue",children:e}),sorter:(e,t)=>e.priority.localeCompare(t.priority)},{title:"Durum",dataIndex:"status",key:"status",render:e=>(0,T.jsx)(m.A,{icon:"completed"===e?(0,T.jsx)(j.A,{}):(0,T.jsx)(v.A,{}),color:"completed"===e?"green":"orange",children:"completed"===e?"Tamamland\u0131":"Beklemede"}),sorter:(e,t)=>e.status.localeCompare(t.status)},{title:"\u0130\u015flemler",key:"actions",render:(e,t)=>(0,T.jsx)(c.A,{children:(0,T.jsx)(u.Ay,{onClick:()=>{R(t),H(!0)},type:"primary",icon:(0,T.jsx)(f.A,{}),children:"Detaylar"})})}];return(0,T.jsxs)("div",{children:[(0,T.jsx)("h2",{children:"\u0130\u015f Takibi"}),(0,T.jsx)(C,{},P),(0,T.jsxs)(n.A,{gutter:16,style:{marginBottom:16},children:[(0,T.jsx)(o.A,{span:6,children:(0,T.jsx)(d.A,{placeholder:"Arama...",value:G.search,onChange:e=>E((t=>({...t,search:e.target.value}))),allowClear:!0})}),(0,T.jsx)(o.A,{span:6,children:(0,T.jsxs)(r.A,{value:G.priority,onChange:e=>E((t=>({...t,priority:e}))),placeholder:"\xd6ncelik Filtresi",style:{width:"100%"},children:[(0,T.jsx)(Z,{value:"all",children:"T\xfcm \xd6ncelikler"}),(0,T.jsx)(Z,{value:"High",children:"Y\xfcksek"}),(0,T.jsx)(Z,{value:"Medium",children:"Orta"}),(0,T.jsx)(Z,{value:"Low",children:"D\xfc\u015f\xfck"})]})}),(0,T.jsx)(o.A,{span:6,children:(0,T.jsxs)(r.A,{value:G.status,onChange:e=>E((t=>({...t,status:e}))),placeholder:"Durum Filtresi",style:{width:"100%"},children:[(0,T.jsx)(Z,{value:"all",children:"T\xfcm Durumlar"}),(0,T.jsx)(Z,{value:"pending",children:"Beklemede"}),(0,T.jsx)(Z,{value:"completed",children:"Tamamland\u0131"})]})}),(0,T.jsx)(o.A,{span:6,children:(0,T.jsxs)(c.A,{children:[(0,T.jsx)(ee,{value:G.dateRange,onChange:e=>E((t=>({...t,dateRange:e}))),style:{width:"100%"}}),(0,T.jsx)(u.Ay,{onClick:()=>E({priority:"all",status:"all",dateRange:null,search:""}),children:"S\u0131f\u0131rla"})]})})]}),S?(0,T.jsx)(y.A,{size:"large"}):(0,T.jsx)(x.A,{columns:V,dataSource:e,rowKey:"id",expandable:{expandedRowRender:e=>{const t=[{title:"A\xe7\u0131klama",dataIndex:"description",key:"description"},{title:"Atanan Ki\u015fi",dataIndex:"assigned_to_name",key:"assigned_to_name",render:e=>e||"Atanmam\u0131\u015f"},{title:"Biti\u015f Tarihi",dataIndex:"due_date",key:"due_date",render:e=>e?b()(e).format("DD.MM.YYYY"):"-"},{title:"Durum",dataIndex:"status",key:"status",render:e=>(0,T.jsx)(m.A,{color:"completed"===e?"green":"gold",children:"completed"===e?"Tamamland\u0131":"Beklemede"})}];return(0,T.jsx)(x.A,{columns:t,dataSource:a[e.id]||[],pagination:!1,rowKey:"id"})},onExpand:(e,t)=>{$(e?e=>[...e,t.id]:e=>e.filter((e=>e!==t.id)))}}}),(0,T.jsx)(k.A,{title:"G\xf6rev D\xfczenle",open:B,onCancel:()=>D(!1),onOk:()=>F.submit(),children:(0,T.jsxs)(i.A,{form:F,layout:"vertical",onFinish:async e=>{try{const t=localStorage.getItem("token"),a={...z,...e,due_date:e.due_date.format("YYYY-MM-DD")};await _.A.put(`http://localhost:5001/api/workflow/tasks/${z.id}`,a,{headers:{Authorization:`Bearer ${t}`}}),h.Ay.success("G\xf6rev ba\u015far\u0131yla g\xfcncellendi!"),q(),K((e=>e+1)),D(!1),M(null)}catch(t){console.error("Error updating task:",t),h.Ay.error("G\xf6rev g\xfcncellenirken bir hata olu\u015ftu")}},initialValues:{description:null===z||void 0===z?void 0:z.description,priority:null===z||void 0===z?void 0:z.priority,due_date:null!==z&&void 0!==z&&z.due_date?b()(z.due_date):null,status:null===z||void 0===z?void 0:z.status},children:[(0,T.jsx)(i.A.Item,{name:"description",label:"A\xe7\u0131klama",rules:[{required:!0,message:"A\xe7\u0131klama gereklidir"}],children:(0,T.jsx)(d.A,{})}),(0,T.jsx)(i.A.Item,{name:"priority",label:"\xd6ncelik",rules:[{required:!0,message:"\xd6ncelik gereklidir"}],children:(0,T.jsxs)(r.A,{children:[(0,T.jsx)(Z,{value:"High",children:"Y\xfcksek"}),(0,T.jsx)(Z,{value:"Medium",children:"Orta"}),(0,T.jsx)(Z,{value:"Low",children:"D\xfc\u015f\xfck"})]})}),(0,T.jsx)(i.A.Item,{name:"due_date",label:"Biti\u015f Tarihi",rules:[{required:!0,message:"Biti\u015f tarihi gereklidir"}],children:(0,T.jsx)(s.A,{})}),(0,T.jsx)(i.A.Item,{name:"status",label:"Durum",rules:[{required:!0,message:"Durum gereklidir"}],children:(0,T.jsxs)(r.A,{children:[(0,T.jsx)(Z,{value:"pending",children:"Beklemede"}),(0,T.jsx)(Z,{value:"completed",children:"Tamamland\u0131"})]})})]})}),(0,T.jsx)(k.A,{title:"G\xf6rev Detaylar\u0131",open:L,onCancel:()=>{H(!1),R(null)},width:800,footer:null,children:O&&(0,T.jsx)(X,{task:O,onUpdate:()=>{q(),H(!1),R(null)}})})]})}}}]);