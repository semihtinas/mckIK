"use strict";(self.webpackChunkmuse_dashboard=self.webpackChunkmuse_dashboard||[]).push([[866],{6866:(e,t,a)=>{a.r(t),a.d(t,{default:()=>pe});var r=a(9950),s=a(4159),n=a.n(s),i=a(9654),l=a(4893),o=a(8902),d=a(9246),c=a(9446),h=a(9135),p=a(5325),u=a(2500),m=a(6092),y=a(6004),f=a(6025),x=a(2460),A=a(7465),g=a(9796),j=a(8576),_=a(6550),v=a(2056),k=a(6869),b=a(9378),S=a(3239),w=a(4118),Y=a(1689),$=a(7376),D=a(6276),I=a(4414);const C="http://localhost:5001",z="shiftCard",T=(0,r.forwardRef)(((e,t)=>{let{departments:a,shiftSchedules:s,selectedDepartment:l,onDepartmentChange:o,onBulkAssign:h,viewDate:p,setViewDate:v}=e;const[k,S]=r.useState([]),[w,Y]=r.useState([]),[$,D]=r.useState(!1),[z,T]=r.useState(null),[F,V]=r.useState(1),[P,B]=r.useState(!1),[E,R]=r.useState(null),[q,O]=r.useState(null),[G,L]=r.useState(null),[K,H]=r.useState(!1),[W,U]=r.useState(!1),[N,Q]=r.useState([]),[J,X]=r.useState(null),[Z,ee]=r.useState({});(0,r.useImperativeHandle)(t,(()=>({fetchWeeklyShifts:ae}))),(0,r.useEffect)((()=>{l&&p&&(ae(),re())}),[l,p]);const te=()=>({headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),ae=async()=>{try{const e=p.startOf("week").format("YYYY-MM-DD"),t=p.endOf("week").format("YYYY-MM-DD"),[a,r,s]=await Promise.all([d.A.get(`${C}/api/shifts/weekly-shifts`,{...te(),params:{startDate:e,endDate:t,departmentId:l}}),d.A.get(`${C}/api/shifts/off-days`,{...te(),params:{startDate:e,endDate:t,departmentId:l}}),d.A.get(`${C}/api/shifts/leave-requests`,{...te(),params:{start_date:e,end_date:t,department_id:l}})]),n=s.data.map((e=>({...e,id:`leave_${e.id}`,is_leave_request:!0,shift_name:`\u0130zin Talebi (${e.status})`,color:"pending"===e.status?"#faad14":"approved"===e.status?"#52c41a":"#f5222d",assignment_date:e.leave_date}))),i=[...a.data,...r.data,...n];S(i)}catch(e){console.error("API Error:",e),i.Ay.error("Vardiya bilgileri y\xfcklenirken hata olu\u015ftu")}},re=async()=>{try{const e=await d.A.get(`${C}/api/shifts/department-personnel/${l}`,te());Y(e.data),await(async e=>{try{const t=e.map((async e=>{try{const t=await d.A.get(`${C}/api/personnel/${e.id}/photo`,te()),a=t.data.photo_url?`${C}${t.data.photo_url}`:null;return{id:e.id,photoUrl:a}}catch(t){return console.error(`Error fetching photo for personnel ${e.id}:`,t),{id:e.id,photoUrl:null}}})),a=await Promise.all(t),r={};a.forEach((e=>{r[e.id]=e.photoUrl})),ee(r)}catch(t){console.error("Error fetching personnel photos:",t)}})(e.data)}catch(e){console.error("Error:",e),i.Ay.error("Personel listesi al\u0131n\u0131rken hata olu\u015ftu")}},se=async(e,t,a,r)=>{try{r?await d.A.put(`${C}/api/shifts/off-days/${e}`,{assignment_date:t,personnel_id:a},te()):await d.A.put(`${C}/api/shifts/assignments/${e}`,{assignment_date:t,personnel_id:a},te()),ae(),i.Ay.success("Atama g\xfcncellendi")}catch(s){console.error("Error updating assignment:",s),i.Ay.error("Atama g\xfcncellenirken hata olu\u015ftu")}},ne=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];try{if(r){if("approve"===e||"reject"===e){const a=t.replace("leave_","");await d.A.put(`${C}/api/shifts/leave-requests/${a}`,{status:"approve"===e?"approved":"rejected"},te()),i.Ay.success("\u0130zin talebi "+("approve"===e?"onayland\u0131":"reddedildi")),ae()}return}if(a)return void("delete"===e&&(await d.A.delete(`${C}/api/shifts/off-days/${t}`,te()),i.Ay.success("\u0130zin g\xfcn\xfc silindi"),ae()));switch(e){case"copy":await ie(t),i.Ay.success("Vardiya ba\u015far\u0131yla kopyaland\u0131"),ae();break;case"delete":await d.A.delete(`${C}/api/shifts/assignments/${t}`,te()),i.Ay.success("Vardiya silindi"),ae();break;case"bulkCopy":T(t),D(!0)}}catch(s){console.error("Error during shift action:",s),i.Ay.error("\u0130\u015flem s\u0131ras\u0131nda hata olu\u015ftu")}},ie=async e=>{try{const t=(await d.A.get(`${C}/api/shifts/assignments/${e}`,te())).data,a=n()(t.assignment_date).add(1,"day").format("YYYY-MM-DD");await d.A.post(`${C}/api/shifts/assignments`,{shift_schedule_id:t.shift_schedule_id,personnel_id:t.personnel_id,assignment_date:a,status:"active"},te())}catch(t){throw console.error("Error copying shift assignment:",t),t}},le=[...Array(7)].map(((e,t)=>p.startOf("week").add(t,"day"))),oe=e=>`${["Pzt","Sal","\xc7ar","Per","Cum","Cmt","Paz"][0===e.day()?6:e.day()-1]} ${e.format("DD/MM")}`,de=(e,t)=>{R(e),O(t),m.A.confirm({title:"Ne eklemek istiyorsunuz?",okText:"Vardiya",cancelText:"\u0130zin G\xfcn\xfc",onOk:()=>{B(!0)},onCancel:async()=>{try{await d.A.post(`${C}/api/shifts/off-days`,{personnel_id:e.id,assignment_date:t.format("YYYY-MM-DD")},te()),i.Ay.success("\u0130zin g\xfcn\xfc ba\u015far\u0131yla eklendi"),ae()}catch(a){console.error("Error adding off day:",a),i.Ay.error("\u0130zin g\xfcn\xfc eklenirken hata olu\u015ftu")}}})},ce=[{title:"Personel Ad\u0131",dataIndex:"first_name",render:(e,t)=>`${t.first_name} ${t.last_name}`},{title:"Tarih",dataIndex:"assignment_date",render:e=>n()(e).format("DD.MM.YYYY")},{title:"Vardiya",dataIndex:"shift_name"},{title:"Ba\u015flang\u0131\xe7",dataIndex:"start_time"},{title:"Biti\u015f",dataIndex:"end_time"}];return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(c.Q,{backend:u.t2,children:(0,I.jsxs)("div",{style:{padding:"16px"},children:[(0,I.jsxs)("div",{style:{marginBottom:16,display:"flex",alignItems:"center"},children:[(0,I.jsxs)(y.A,{children:[(0,I.jsx)(f.A,{style:{width:200},placeholder:"Departman Se\xe7in",onChange:e=>{null===o||void 0===o||o(e)},value:l,children:a.map((e=>(0,I.jsx)(f.A.Option,{value:e.id,children:e.name},e.id)))}),(0,I.jsx)(x.A,{picker:"week",value:p,onChange:e=>e&&v(e)})]}),(0,I.jsxs)("div",{style:{marginLeft:"auto",display:"flex",gap:"8px"},children:[(0,I.jsx)(A.Ay,{type:"primary",onClick:h,children:"Toplu \u0130\u015flemler"}),(0,I.jsx)(A.Ay,{onClick:()=>{H(!0)},children:"Publish"})]})]}),(0,I.jsxs)("div",{style:{background:"#fff",padding:16,borderRadius:8,border:"1px solid #f0f0f0"},children:[(0,I.jsxs)("div",{style:{display:"flex",borderBottom:"1px solid #f0f0f0",fontWeight:"bold",padding:"8px 0"},children:[(0,I.jsx)("div",{style:{width:"16%",minWidth:"150px",borderRight:"1px solid #f0f0f0",padding:"8px",boxSizing:"border-box"},children:"Personel"}),le.map((e=>(0,I.jsx)("div",{style:{width:`${12..toFixed(2)}%`,borderRight:"1px solid #f0f0f0",textAlign:"center",padding:"8px",boxSizing:"border-box"},children:oe(e)},e.format())))]}),w.map((e=>(0,I.jsxs)("div",{style:{display:"flex",borderBottom:"1px solid #f0f0f0",minHeight:"80px"},children:[(0,I.jsxs)("div",{style:{width:"16%",minWidth:"180px",borderRight:"1px solid #f0f0f0",padding:"8px",display:"flex",alignItems:"center",boxSizing:"border-box",gap:"8px"},children:[(0,I.jsx)(g.A,{src:Z[e.id],icon:(0,I.jsx)(b.A,{}),style:{border:"2px solid #f0f0f0",backgroundColor:"#fff",width:"64px",height:"64px"}}),(0,I.jsxs)("span",{children:[e.first_name," ",e.last_name]})]}),le.map((t=>{const a=k.filter((a=>a.personnel_id===e.id&&n()(a.assignment_date).isSame(t,"day")));return(0,I.jsx)(M,{person:e,day:t,dayShifts:a,handleShiftDrop:se,handleShiftAction:ne,onCellClick:de,style:{width:`${12..toFixed(2)}%`,borderRight:"1px solid #f0f0f0",boxSizing:"border-box"}},`${e.id}-${t.format("YYYY-MM-DD")}`)}))]},e.id)))]})]})}),(0,I.jsxs)(m.A,{title:"Vardiyay\u0131 \xc7oklu Kopyala",open:$,onCancel:()=>D(!1),onOk:async()=>{try{await(async(e,t)=>{try{const a=(await d.A.get(`${C}/api/shifts/assignments/${e}`,te())).data,r=[];for(let e=1;e<=t;e++){const t=n()(a.assignment_date).add(e,"day").format("YYYY-MM-DD");r.push(d.A.post(`${C}/api/shifts/assignments`,{shift_schedule_id:a.shift_schedule_id,personnel_id:a.personnel_id,assignment_date:t,status:"active"},te()))}await Promise.all(r)}catch(a){throw console.error("Error in bulk copying shift assignment:",a),a}})(z,F),i.Ay.success("Vardiya ba\u015far\u0131yla \xe7oklu kopyaland\u0131"),ae(),D(!1)}catch(e){i.Ay.error("\u0130\u015flem s\u0131ras\u0131nda hata olu\u015ftu")}},children:[(0,I.jsx)("p",{children:"Ka\xe7 g\xfcn boyunca kopyalamak istiyorsunuz?"}),(0,I.jsx)(j.A,{min:1,max:365,value:F,onChange:e=>V(e)})]}),(0,I.jsxs)(m.A,{title:"Vardiya Ekle",open:P,onCancel:()=>{B(!1),L(null)},onOk:async()=>{if(G&&E&&q)try{await d.A.post(`${C}/api/shifts/assignments`,{shift_schedule_id:G,personnel_id:E.id,assignment_date:q.format("YYYY-MM-DD"),status:"active"},te()),i.Ay.success("Vardiya ba\u015far\u0131yla eklendi"),ae(),B(!1),L(null)}catch(e){console.error("Error adding shift assignment:",e),i.Ay.error("Vardiya eklenirken hata olu\u015ftu")}else i.Ay.warning("L\xfctfen t\xfcm bilgileri se\xe7in")},children:[(0,I.jsx)("p",{children:E?`${E.first_name} ${E.last_name} i\xe7in ${null===q||void 0===q?void 0:q.format("DD/MM/YYYY")} tarihine vardiya ekle:`:""}),(0,I.jsx)(f.A,{style:{width:"100%"},placeholder:"Vardiya Se\xe7in",value:G,onChange:e=>L(e),children:s.map((e=>(0,I.jsxs)(f.A.Option,{value:e.id,children:[e.name," (",e.start_time," - ",e.end_time,")"]},e.id)))})]}),(0,I.jsxs)(m.A,{title:"Vardiya Plan\u0131 Yay\u0131nlama",open:K,onCancel:()=>H(!1),footer:null,children:[(0,I.jsx)("p",{children:"L\xfctfen tarih aral\u0131\u011f\u0131 se\xe7in:"}),(0,I.jsx)(x.A.RangePicker,{onChange:e=>{X(e)}}),(0,I.jsx)("div",{style:{marginTop:16,textAlign:"right"},children:(0,I.jsx)(A.Ay,{onClick:async()=>{if(!J||!l)return void i.Ay.warning("L\xfctfen departman ve tarih aral\u0131\u011f\u0131 se\xe7in");const[e,t]=[J[0].format("YYYY-MM-DD"),J[1].format("YYYY-MM-DD")];try{const a=te(),r=await d.A.get(`${C}/api/shifts/preview`,{...a,params:{departmentId:l,start_date:e,end_date:t}});Q(r.data.assignments),U(!0)}catch(a){console.error("Error fetching preview:",a),i.Ay.error("\xd6nizleme al\u0131n\u0131rken hata olu\u015ftu")}},type:"primary",children:"\xd6nizleme Al"})})]}),(0,I.jsx)(m.A,{title:"\xd6nizleme",open:W,onCancel:()=>U(!1),footer:[(0,I.jsx)(A.Ay,{onClick:()=>U(!1),children:"\u0130ptal"},"cancel"),(0,I.jsx)(A.Ay,{type:"primary",onClick:async()=>{if(!J||!l)return void i.Ay.warning("L\xfctfen departman ve tarih aral\u0131\u011f\u0131 se\xe7in");const[e,t]=[J[0].format("YYYY-MM-DD"),J[1].format("YYYY-MM-DD")];try{const a=te();await d.A.post(`${C}/api/shifts/publish-pdf`,{departmentId:l,startDate:e,endDate:t},a),i.Ay.success("Vardiya plan\u0131 mail olarak g\xf6nderildi (PDF)."),H(!1),U(!1),X(null),Q([])}catch(a){console.error("Error publishing shifts:",a),i.Ay.error("Yay\u0131nlama s\u0131ras\u0131nda hata olu\u015ftu")}},children:"Onayla ve Mail G\xf6nder"},"confirm")],children:(0,I.jsx)(_.A,{columns:ce,dataSource:N,rowKey:"id"})})]})})),M=e=>{let{person:t,day:a,dayShifts:r,handleShiftDrop:s,handleShiftAction:n,onCellClick:i,style:l}=e;const[{isOver:o},d]=(0,h.H)({accept:z,drop:e=>{s(e.id,a.format("YYYY-MM-DD"),t.id,e.isOffDay)},collect:e=>({isOver:!!e.isOver()})});return(0,I.jsx)("div",{ref:d,onClick:e=>{e.target.closest(".ant-card")||e.target.closest(".ant-dropdown")||i(t,a)},style:{...l,padding:"4px",backgroundColor:o?"#e6f7ff":"inherit",minHeight:"80px",cursor:"pointer",overflow:"hidden",position:"relative"},children:r.map((e=>(0,I.jsx)(F,{shift:e,handleShiftAction:n},e.id)))})},F=e=>{let{shift:t,handleShiftAction:a}=e;const r=t.is_off_day||!1,s=t.is_leave_request||!1,[{isDragging:n},i]=(0,p.i)({type:z,item:{id:t.id,isOffDay:r,isLeaveRequest:s},canDrag:!s,collect:e=>({isDragging:!!e.isDragging()})}),l={items:s?"pending"===t.status?[{key:"approve",icon:(0,I.jsx)(S.A,{}),label:"Onayla"},{key:"reject",icon:(0,I.jsx)(w.A,{}),label:"Reddet"}]:[]:r?[{key:"delete",icon:(0,I.jsx)(Y.A,{}),label:"Sil"}]:[{key:"copy",icon:(0,I.jsx)($.A,{}),label:"Kopyala"},{key:"delete",icon:(0,I.jsx)(Y.A,{}),label:"Sil"},{key:"bulkCopy",icon:(0,I.jsx)(D.A,{}),label:"\xc7oklu Kopyala"}]},o={size:"small",style:{backgroundColor:t.color||"#f0f0f0",marginBottom:4,color:V(t.color||"#f0f0f0"),minHeight:"60px",fontSize:"14px",opacity:n?.5:1,cursor:s?"default":"move"}};return(0,I.jsxs)(v.A,{ref:s?null:i,...o,onClick:e=>e.stopPropagation(),bodyStyle:{padding:"8px",whiteSpace:"normal",overflowWrap:"break-word"},actions:l.items.length>0?[(0,I.jsx)(k.A,{menu:{items:l.items,onClick:e=>{let{key:n}=e;a(n,t.id,r,s)}},trigger:["click"],children:(0,I.jsx)(A.Ay,{type:"text",icon:(0,I.jsx)(D.A,{}),onClick:e=>e.stopPropagation()})},"dropdown")]:[],children:[t.shift_name,s&&t.reason&&(0,I.jsxs)("div",{style:{fontSize:"12px",marginTop:"4px"},children:["Sebep: ",t.reason]})]})};function V(e){const t=e.replace("#","");return(299*parseInt(t.slice(0,2),16)+587*parseInt(t.slice(2,4),16)+114*parseInt(t.slice(4,6),16))/1e3>125?"#000000":"#ffffff"}var P=a(2748);const B=e=>{let{departments:t,shiftSchedules:a,selectedDepartment:s,onDepartmentChange:l,onBulkAssign:o,viewDate:c,setViewDate:h}=e;const[p,u]=r.useState([]),[m,j]=r.useState([]),[v,k]=r.useState(!1),[S,w]=r.useState({}),Y="http://localhost:5001";(0,r.useEffect)((()=>{s&&c&&D()}),[s,c]);const $=()=>({headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),D=async()=>{try{k(!0);const e=c.startOf("month").format("YYYY-MM-DD"),t=c.endOf("month").format("YYYY-MM-DD"),[a,r,n,i]=await Promise.all([d.A.get(`${Y}/api/shifts/weekly-shifts`,{...$(),params:{startDate:e,endDate:t,departmentId:s}}),d.A.get(`${Y}/api/shifts/off-days`,{...$(),params:{startDate:e,endDate:t,departmentId:s}}),d.A.get(`${Y}/api/shifts/leave-requests`,{...$(),params:{start_date:e,end_date:t,department_id:s}}),d.A.get(`${Y}/api/shifts/department-personnel/${s}`,$())]),l=[...a.data,...r.data,...n.data];u(l),j(i.data),await(async e=>{try{const t=e.map((async e=>{try{const t=await d.A.get(`${Y}/api/personnel/${e.id}/photo`,$()),a=t.data.photo_url?`${Y}${t.data.photo_url}`:null;return{id:e.id,photoUrl:a}}catch(t){return console.error(`Error fetching photo for personnel ${e.id}:`,t),{id:e.id,photoUrl:null}}})),a=await Promise.all(t),r={};a.forEach((e=>{r[e.id]=e.photoUrl})),w(r)}catch(t){console.error("Error fetching personnel photos:",t)}})(i.data)}catch(e){console.error("Error fetching monthly data:",e),i.Ay.error("Veriler y\xfcklenirken hata olu\u015ftu")}finally{k(!1)}},C={backgroundColor:"#52c41a",padding:4,borderRadius:4,color:"#fff",textAlign:"center"},z={backgroundColor:"#fa8c16",padding:4,borderRadius:4,color:"#fff",textAlign:"center"};return(0,I.jsxs)("div",{style:{padding:"16px"},children:[(0,I.jsxs)("div",{style:{marginBottom:16,display:"flex",alignItems:"center"},children:[(0,I.jsxs)(y.A,{children:[(0,I.jsx)(f.A,{style:{width:200},placeholder:"Departman Se\xe7in",onChange:e=>{null===l||void 0===l||l(e)},value:s,children:t.map((e=>(0,I.jsx)(f.A.Option,{value:e.id,children:e.name},e.id)))}),(0,I.jsx)(x.A,{picker:"month",value:c,onChange:e=>{e&&h(e)}})]}),(0,I.jsx)("div",{style:{marginLeft:"auto"},children:(0,I.jsx)(A.Ay,{type:"primary",onClick:o,children:"Toplu \u0130\u015flemler"})})]}),(0,I.jsx)(_.A,{columns:(()=>{if(!c)return[];const e=c.daysInMonth();return[...[{title:"Personel",dataIndex:"name",key:"name",fixed:"left",width:200,render:(e,t)=>(0,I.jsxs)(y.A,{children:[(0,I.jsx)(g.A,{src:S[t.id],icon:(0,I.jsx)(b.A,{}),style:{border:"2px solid #f0f0f0",backgroundColor:"#fff",width:"32px",height:"32px"}}),(0,I.jsx)("span",{children:e})]})}],...Array.from({length:e},((e,t)=>{const a=t+1,r=c.date(a),s=0===r.day()||6===r.day();return{title:a.toString(),dataIndex:a.toString(),key:a.toString(),width:50,align:"center",className:s?"weekend-column":"",render:e=>e?e.is_off_day?(0,I.jsx)(P.A,{title:"\u0130zin G\xfcn\xfc",children:(0,I.jsx)("div",{style:C,children:"\u0130"})}):e.is_leave_request?(0,I.jsx)(P.A,{title:`\u0130zin Talebi (${e.status})`,children:(0,I.jsx)("div",{style:z,children:"T"})}):e.shift_name?(0,I.jsx)(P.A,{title:`${e.shift_name} (${e.start_time}-${e.end_time})`,children:(0,I.jsx)("div",{style:{backgroundColor:e.color||"#f0f0f0",padding:4,borderRadius:4,color:"#fff",textAlign:"center"},children:e.shift_name.substring(0,1)})}):null:null}}))]})(),dataSource:c?m.map((e=>{const t={key:e.id,id:e.id,name:`${e.first_name} ${e.last_name}`};for(let a=1;a<=c.daysInMonth();a++){const r=c.date(a).format("YYYY-MM-DD"),s=p.find((t=>t.personnel_id===e.id&&n()(t.assignment_date).format("YYYY-MM-DD")===r));t[a.toString()]=s||null}return t})):[],loading:v,pagination:!1,scroll:{x:"max-content"},bordered:!0,size:"small"}),(0,I.jsx)("style",{children:"\n        .weekend-column {\n          background-color: #fafafa;\n        }\n        .ant-table-cell {\n          padding: 4px !important;\n        }\n      "})]})};var E=a(3561),R=a(3658),q=a(6895),O=a(974);const G="http://localhost:5001",{RangePicker:L}=x.A,{Option:K}=f.A,{TabPane:H}=o.A,W=e=>{let{visible:t,onCancel:a,onComplete:s,departmentId:n,shiftSchedules:c}=e;const[h]=E.A.useForm(),[p,u]=(0,r.useState)(!1),[m,x]=(0,r.useState)("auto"),[g,_]=(0,r.useState)([]),[v,k]=(0,r.useState)([]),[S,w]=(0,r.useState)([]),[Y,C]=(0,r.useState)("personnel");(0,r.useEffect)((()=>{t&&n&&(T(),"template"===m&&(M(),F()))}),[t,n,m]),(0,r.useEffect)((()=>{"template"===m&&t&&n&&(M(),F())}),[m]);const z=()=>({headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),T=async()=>{try{const e=await d.A.get(`${G}/api/shifts/department-personnel/${n}`,z());_(e.data)}catch(e){console.error("Error:",e),i.Ay.error("Personel listesi al\u0131n\u0131rken hata olu\u015ftu")}},M=async()=>{try{const e=(await d.A.get(`${G}/api/shifts/groups`,z())).data.filter((e=>e.department_id===parseInt(n)));k(e)}catch(e){console.error("Error fetching groups:",e),i.Ay.error("Grup listesi al\u0131n\u0131rken hata olu\u015ftu")}},F=async()=>{try{const e=(await d.A.get(`${G}/api/shifts/templates`,z())).data.filter((e=>e.department_id===parseInt(n)));w(e)}catch(e){console.error("Error fetching templates:",e),i.Ay.error("\u015eablonlar al\u0131n\u0131rken hata olu\u015ftu")}},V=()=>{h.resetFields(),x("auto"),a()};return(0,I.jsx)(R.A,{title:"Toplu Vardiya \u0130\u015flemleri",placement:"right",width:600,onClose:V,open:t,children:(0,I.jsxs)(E.A,{form:h,layout:"vertical",onFinish:async e=>{if(n){u(!0);try{if("copy"===m)await d.A.post(`${G}/api/shifts/copy-last-week`,{startDate:e.dateRange[0].format("YYYY-MM-DD"),endDate:e.dateRange[1].format("YYYY-MM-DD"),departmentId:n},z());else if("auto"===m)await d.A.post(`${G}/api/shifts/auto-assignments`,{startDate:e.dateRange[0].format("YYYY-MM-DD"),endDate:e.dateRange[1].format("YYYY-MM-DD"),departmentId:n,personnelIds:e.personnel,shiftScheduleId:e.shiftType,daysOff:e.daysOff,includeWeekends:e.includeWeekends},z());else if("template"===m){if(!e.template_id)return i.Ay.warning("L\xfctfen bir \u015fablon se\xe7in"),void u(!1);const t={start_date:e.dateRange[0].format("YYYY-MM-DD"),end_date:e.dateRange[1].format("YYYY-MM-DD")};if("personnel"===Y){if(!e.personnelTemplate||0===e.personnelTemplate.length)return i.Ay.warning("L\xfctfen personel se\xe7in"),void u(!1);t.personnel_ids=e.personnelTemplate}else{if(!e.groupsTemplate||0===e.groupsTemplate.length)return i.Ay.warning("L\xfctfen grup se\xe7in"),void u(!1);t.group_ids=e.groupsTemplate}await d.A.post(`${G}/api/shifts/templates/${e.template_id}/apply`,t,z())}i.Ay.success("\u0130\u015flem ba\u015far\u0131yla tamamland\u0131"),h.resetFields(),null===s||void 0===s||s()}catch(t){console.error("Error in bulk assignment:",t),i.Ay.error("\u0130\u015flem s\u0131ras\u0131nda hata olu\u015ftu")}finally{u(!1)}}else i.Ay.error("L\xfctfen bir departman se\xe7in")},initialValues:{assignmentType:"auto",includeWeekends:!1,daysOff:2},children:[(0,I.jsx)(E.A.Item,{name:"assignmentType",children:(0,I.jsx)(l.Ay.Group,{onChange:e=>x(e.target.value),children:(0,I.jsxs)(y.A,{direction:"vertical",children:[(0,I.jsx)(l.Ay,{value:"auto",children:(0,I.jsxs)(y.A,{children:[(0,I.jsx)(D.A,{}),"Otomatik Atama"]})}),(0,I.jsx)(l.Ay,{value:"copy",children:(0,I.jsxs)(y.A,{children:[(0,I.jsx)($.A,{}),"Ge\xe7en Haftay\u0131 Kopyala"]})}),(0,I.jsx)(l.Ay,{value:"template",children:(0,I.jsxs)(y.A,{children:[(0,I.jsx)(b.A,{}),"\u015eablon Uygula"]})})]})})}),(0,I.jsx)(E.A.Item,{name:"dateRange",label:"Tarih Aral\u0131\u011f\u0131",rules:[{required:!0,message:"Tarih aral\u0131\u011f\u0131 se\xe7in"}],children:(0,I.jsx)(L,{style:{width:"100%"}})}),"auto"===m&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(E.A.Item,{name:"personnel",label:"Personel Se\xe7imi",rules:[{required:!0,message:"En az bir personel se\xe7in"}],children:(0,I.jsx)(f.A,{mode:"multiple",placeholder:"Personel se\xe7in",style:{width:"100%"},showSearch:!0,optionFilterProp:"children",filterOption:(e,t)=>{var a;return(null!==(a=null===t||void 0===t?void 0:t.children)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},children:g.map((e=>(0,I.jsx)(K,{value:e.id,children:`${e.first_name} ${e.last_name}`},e.id)))})}),(0,I.jsx)(E.A.Item,{name:"shiftType",label:"Vardiya T\xfcr\xfc",rules:[{required:!0,message:"Vardiya t\xfcr\xfc se\xe7in"}],children:(0,I.jsx)(f.A,{placeholder:"Vardiya t\xfcr\xfc se\xe7in",children:c.map((e=>(0,I.jsxs)(K,{value:e.id,children:[e.name," (",e.start_time,"-",e.end_time,")"]},e.id)))})}),(0,I.jsx)(E.A.Item,{name:"daysOff",label:"Haftal\u0131k \u0130zin G\xfcn\xfc Say\u0131s\u0131",rules:[{required:!0}],children:(0,I.jsx)(j.A,{min:0,max:7,style:{width:"100%"}})}),(0,I.jsx)(E.A.Item,{name:"includeWeekends",valuePropName:"checked",label:"Hafta Sonlar\u0131 Dahil",children:(0,I.jsx)(q.A,{})})]}),"template"===m&&(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(E.A.Item,{name:"template_id",label:"\u015eablon Se\xe7",rules:[{required:!0,message:"L\xfctfen bir \u015fablon se\xe7in"}],children:(0,I.jsx)(f.A,{placeholder:"\u015eablon se\xe7in",loading:p,style:{width:"100%"},children:S.map((e=>(0,I.jsx)(K,{value:e.id,children:e.name},e.id)))})}),(0,I.jsxs)(o.A,{activeKey:Y,onChange:C,style:{marginBottom:16},children:[(0,I.jsx)(H,{tab:(0,I.jsxs)("span",{children:[(0,I.jsx)(b.A,{}),"Personel"]}),children:(0,I.jsx)(E.A.Item,{name:"personnelTemplate",rules:[{required:"personnel"===Y,message:"L\xfctfen personel se\xe7in"}],children:(0,I.jsx)(f.A,{mode:"multiple",placeholder:"Personel se\xe7in",loading:p,showSearch:!0,optionFilterProp:"children",style:{width:"100%"},children:g.map((e=>(0,I.jsx)(K,{value:e.id,children:`${e.first_name} ${e.last_name}`},e.id)))})})},"personnel"),(0,I.jsx)(H,{tab:(0,I.jsxs)("span",{children:[(0,I.jsx)(O.A,{}),"Grup"]}),children:(0,I.jsx)(E.A.Item,{name:"groupsTemplate",rules:[{required:"group"===Y,message:"L\xfctfen grup se\xe7in"}],children:(0,I.jsx)(f.A,{mode:"multiple",placeholder:"Grup se\xe7in",loading:p,style:{width:"100%"},children:v.map((e=>(0,I.jsx)(K,{value:e.id,children:e.name},e.id)))})})},"group")]})]}),(0,I.jsx)(E.A.Item,{className:"text-right",children:(0,I.jsxs)(y.A,{children:[(0,I.jsx)(A.Ay,{onClick:V,children:"\u0130ptal"}),(0,I.jsx)(A.Ay,{type:"primary",htmlType:"submit",loading:p,children:"auto"===m?"Otomatik Ata":"copy"===m?"Kopyala":"Uygula"})]})})]})})};var U=a(5621),N=a(5355),Q=a(7796),J=a(8750),X=a(4513);const{Option:Z}=f.A,ee=e=>{let{departments:t,onSettingsUpdate:a}=e;const[s,l]=(0,r.useState)([]),[c,h]=(0,r.useState)([]),[p,u]=(0,r.useState)([]),[x,g]=(0,r.useState)(!1),[j,v]=(0,r.useState)(!1),[k,b]=(0,r.useState)(!1),[S,w]=(0,r.useState)(null),[$]=E.A.useForm(),[D]=E.A.useForm(),[C]=E.A.useForm();(0,r.useEffect)((()=>{z()}),[]);const z=async()=>{try{const e={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},[t,a,r]=await Promise.all([d.A.get("http://localhost:5001/api/shifts/shift-types",e),d.A.get("http://localhost:5001/api/shifts/shift-schedules",e),d.A.get("http://localhost:5001/api/shifts/department-shift-settings",e)]);l(t.data),h(a.data),u(r.data)}catch(e){console.error("Error fetching settings:",e),i.Ay.error("Ayarlar y\xfcklenirken hata olu\u015ftu")}},T=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(w(t),e){case"shiftType":$.setFieldsValue(t||{}),g(!0);break;case"schedule":t&&D.setFieldsValue({...t,shift_type_id:t.shift_type_id,start_time:n()(t.start_time,"HH:mm"),end_time:n()(t.end_time,"HH:mm")}),v(!0)}},M=async(e,t)=>{try{const r={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},s={shiftType:"/shift-types/",schedule:"/shift-schedules/",departmentSetting:"/department-shift-settings/"};await d.A.delete(`http://localhost:5001/api/shifts${s[e]}${t}`,r),i.Ay.success("Ba\u015far\u0131yla silindi"),z(),null===a||void 0===a||a()}catch(r){i.Ay.error("Silme i\u015flemi ba\u015far\u0131s\u0131z oldu")}},F=async(e,t)=>{try{const r={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}};let s="",n=t;switch(e){case"shiftType":s="/shift-types";break;case"schedule":s="/shift-schedules",n={...t,start_time:t.start_time.format("HH:mm"),end_time:t.end_time.format("HH:mm")}}null!==S&&void 0!==S&&S.id?await d.A.put(`http://localhost:5001/api/shifts${s}/${S.id}`,n,r):await d.A.post(`http://localhost:5001/api/shifts${s}`,n,r),i.Ay.success("Ba\u015far\u0131yla kaydedildi"),z(),null===a||void 0===a||a(),V(e)}catch(r){i.Ay.error("Kay\u0131t i\u015flemi ba\u015far\u0131s\u0131z oldu")}},V=e=>{switch(e){case"shiftType":g(!1),$.resetFields();break;case"schedule":v(!1),D.resetFields();break;case"departmentSetting":b(!1),C.resetFields()}w(null)},P=[{key:"1",label:"Vardiya T\xfcrleri",children:(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(A.Ay,{type:"primary",icon:(0,I.jsx)(J.A,{}),onClick:()=>T("shiftType"),style:{marginBottom:16},children:"Yeni Vardiya T\xfcr\xfc"}),(0,I.jsx)(_.A,{columns:[{title:"Vardiya T\xfcr\xfc",dataIndex:"name"},{title:"A\xe7\u0131klama",dataIndex:"description"},{title:"\u0130\u015flemler",key:"actions",render:(e,t)=>(0,I.jsxs)(y.A,{children:[(0,I.jsx)(A.Ay,{icon:(0,I.jsx)(X.A,{}),onClick:()=>T("shiftType",t)}),(0,I.jsx)(A.Ay,{danger:!0,icon:(0,I.jsx)(Y.A,{}),onClick:()=>M("shiftType",t.id)})]})}],dataSource:s,rowKey:"id"})]})},{key:"2",label:"Vardiya Planlar\u0131",children:(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(A.Ay,{type:"primary",icon:(0,I.jsx)(J.A,{}),onClick:()=>T("schedule"),style:{marginBottom:16},children:"Yeni Vardiya Plan\u0131"}),(0,I.jsx)(_.A,{columns:[{title:"Vardiya Ad\u0131",dataIndex:"name"},{title:"Vardiya T\xfcr\xfc",dataIndex:"shift_type_name"},{title:"Ba\u015flang\u0131\xe7",dataIndex:"start_time"},{title:"Biti\u015f",dataIndex:"end_time"},{title:"Renk",dataIndex:"color",render:e=>(0,I.jsx)(U.A,{color:e,style:{width:50,height:20}})},{title:"\u0130\u015flemler",key:"actions",render:(e,t)=>(0,I.jsxs)(y.A,{children:[(0,I.jsx)(A.Ay,{icon:(0,I.jsx)(X.A,{}),onClick:()=>T("schedule",t)}),(0,I.jsx)(A.Ay,{danger:!0,icon:(0,I.jsx)(Y.A,{}),onClick:()=>M("schedule",t.id)})]})}],dataSource:c,rowKey:"id"})]})}];return(0,I.jsxs)("div",{children:[(0,I.jsx)(o.A,{items:P}),(0,I.jsx)(m.A,{title:""+(S?"Vardiya T\xfcr\xfc D\xfczenle":"Yeni Vardiya T\xfcr\xfc"),open:x,onCancel:()=>V("shiftType"),footer:null,children:(0,I.jsxs)(E.A,{form:$,onFinish:e=>F("shiftType",e),layout:"vertical",children:[(0,I.jsx)(E.A.Item,{name:"name",label:"Vardiya T\xfcr\xfc Ad\u0131",rules:[{required:!0}],children:(0,I.jsx)(N.A,{})}),(0,I.jsx)(E.A.Item,{name:"description",label:"A\xe7\u0131klama",children:(0,I.jsx)(N.A.TextArea,{})}),(0,I.jsx)(E.A.Item,{children:(0,I.jsx)(A.Ay,{type:"primary",htmlType:"submit",children:"Kaydet"})})]})}),(0,I.jsx)(m.A,{title:""+(S?"Vardiya Plan\u0131 D\xfczenle":"Yeni Vardiya Plan\u0131"),open:j,onCancel:()=>V("schedule"),footer:null,children:(0,I.jsxs)(E.A,{form:D,onFinish:e=>F("schedule",e),layout:"vertical",children:[(0,I.jsx)(E.A.Item,{name:"name",label:"Vardiya Ad\u0131",rules:[{required:!0}],children:(0,I.jsx)(N.A,{})}),(0,I.jsx)(E.A.Item,{name:"shift_type_id",label:"Vardiya T\xfcr\xfc",rules:[{required:!0,message:"L\xfctfen bir vardiya t\xfcr\xfc se\xe7in"}],children:(0,I.jsx)(f.A,{placeholder:"Vardiya T\xfcr\xfc Se\xe7in",children:s.map((e=>(0,I.jsx)(Z,{value:e.id,children:e.name},e.id)))})}),(0,I.jsx)(E.A.Item,{name:"start_time",label:"Ba\u015flang\u0131\xe7 Saati",rules:[{required:!0}],children:(0,I.jsx)(Q.A,{format:"HH:mm"})}),(0,I.jsx)(E.A.Item,{name:"end_time",label:"Biti\u015f Saati",rules:[{required:!0}],children:(0,I.jsx)(Q.A,{format:"HH:mm"})}),(0,I.jsx)(E.A.Item,{name:"color",label:"Renk",rules:[{required:!0}],children:(0,I.jsx)(N.A,{type:"color"})}),(0,I.jsx)(E.A.Item,{children:(0,I.jsx)(A.Ay,{type:"primary",htmlType:"submit",children:"Kaydet"})})]})})]})},{TabPane:te}=o.A,{RangePicker:ae}=x.A,re="http://localhost:5001",se=e=>{let{visible:t,onCancel:a,onComplete:s,template:n,departmentId:l}=e;const[c]=E.A.useForm(),[h,p]=(0,r.useState)(!1),[u,x]=(0,r.useState)([]),[g,j]=(0,r.useState)([]),[_,v]=(0,r.useState)("personnel");(0,r.useEffect)((()=>{t&&l&&S()}),[t,l]);const k=()=>({headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),S=async()=>{try{p(!0);const e=await d.A.get(`${re}/api/shifts/department-personnel/${l}`,k());x(e.data);const t=(await d.A.get(`${re}/api/shifts/groups`,k())).data.filter((e=>e.department_id===parseInt(l)));j(t)}catch(e){console.error("Error fetching data:",e),i.Ay.error("Veri y\xfcklenirken hata olu\u015ftu")}finally{p(!1)}},w=()=>{c.resetFields(),a()};return(0,I.jsx)(m.A,{title:`\u015eablon Uygula: ${(null===n||void 0===n?void 0:n.name)||""}`,open:t,onCancel:w,footer:null,width:600,children:(0,I.jsxs)(E.A,{form:c,onFinish:async e=>{try{p(!0);const t={start_date:e.date_range[0].format("YYYY-MM-DD"),end_date:e.date_range[1].format("YYYY-MM-DD"),personnel_ids:"personnel"===_?e.personnel:void 0,group_ids:"group"===_?e.groups:void 0};"personnel"===_?t.personnel_ids=e.personnel:t.group_ids=e.groups,await d.A.post(`${re}/api/shifts/templates/${n.id}/apply`,t,k()),i.Ay.success("\u015eablon ba\u015far\u0131yla uyguland\u0131"),c.resetFields(),s()}catch(t){console.error("Error applying template:",t),i.Ay.error("\u015eablon uygulan\u0131rken hata olu\u015ftu")}finally{p(!1)}},layout:"vertical",children:[(0,I.jsxs)(o.A,{activeKey:_,onChange:v,children:[(0,I.jsx)(te,{tab:(0,I.jsxs)("span",{children:[(0,I.jsx)(b.A,{}),"Personel Se\xe7"]}),children:(0,I.jsx)(E.A.Item,{name:"personnel",rules:[{required:"personnel"===_,message:"L\xfctfen personel se\xe7in"}],children:(0,I.jsx)(f.A,{mode:"multiple",placeholder:"Personel se\xe7in",loading:h,showSearch:!0,optionFilterProp:"children",style:{width:"100%"},children:u.map((e=>(0,I.jsx)(f.A.Option,{value:e.id,children:`${e.first_name} ${e.last_name}`},e.id)))})})},"personnel"),(0,I.jsx)(te,{tab:(0,I.jsxs)("span",{children:[(0,I.jsx)(O.A,{}),"Grup Se\xe7"]}),children:(0,I.jsx)(E.A.Item,{name:"groups",rules:[{required:"group"===_,message:"L\xfctfen grup se\xe7in"}],children:(0,I.jsx)(f.A,{mode:"multiple",placeholder:"Grup se\xe7in",loading:h,style:{width:"100%"},children:g.map((e=>(0,I.jsx)(f.A.Option,{value:e.id,children:e.name},e.id)))})})},"group")]}),(0,I.jsx)(E.A.Item,{name:"date_range",label:"Tarih Aral\u0131\u011f\u0131",rules:[{required:!0,message:"L\xfctfen tarih aral\u0131\u011f\u0131 se\xe7in"}],children:(0,I.jsx)(ae,{style:{width:"100%"}})}),(0,I.jsx)(E.A.Item,{className:"text-right",children:(0,I.jsxs)(y.A,{children:[(0,I.jsx)(A.Ay,{onClick:w,children:"\u0130ptal"}),(0,I.jsx)(A.Ay,{type:"primary",htmlType:"submit",loading:h,children:"Uygula"})]})})]})})},{Option:ne}=f.A,ie=e=>{let{departments:t,shiftSchedules:a}=e;const[s,n]=(0,r.useState)([]),[l,o]=(0,r.useState)(!1),[c,h]=(0,r.useState)(!1),[p,u]=(0,r.useState)(null),[x]=E.A.useForm(),[g,v]=(0,r.useState)(!1);(0,r.useEffect)((()=>{b()}),[]);const k=()=>({headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),b=async()=>{try{const e=await d.A.get("http://localhost:5001/api/shifts/templates",k());console.log("Gelen \u015eablonlar:",e.data),n(e.data)}catch(e){i.Ay.error("\u015eablonlar y\xfcklenirken hata olu\u015ftu")}},S=async e=>{try{const t=e.shifts.map(((e,t)=>({day_index:t,shift_schedule_id:e.shift_schedule_id,rest_day:e.is_rest_day||!1}))),a={name:e.name,department_id:e.department_id,is_rotation:e.is_rotation,rotation_days:e.is_rotation?e.rotation_days:null,patterns:t};p?(await d.A.put(`http://localhost:5001/api/shifts/templates/${p.id}`,a,k()),i.Ay.success("\u015eablon g\xfcncellendi")):(await d.A.post("http://localhost:5001/api/shifts/templates",a,k()),i.Ay.success("\u015eablon olu\u015fturuldu")),o(!1),x.resetFields(),b()}catch(t){console.error("Hata:",t),i.Ay.error("\u0130\u015flem ba\u015far\u0131s\u0131z oldu")}},w=[{title:"\u015eablon Ad\u0131",dataIndex:"name"},{title:"Departman",dataIndex:"department_name"},{title:"Rotasyon",dataIndex:"is_rotation",render:(e,t)=>(0,I.jsx)(U.A,{color:e?"blue":"default",children:e?`${t.rotation_days} g\xfcnl\xfck rotasyon`:"Sabit vardiya"})},{title:"Vardiya D\xfczeni",dataIndex:"patterns",render:e=>(0,I.jsx)("div",{style:{maxWidth:300,overflow:"hidden"},children:null===e||void 0===e?void 0:e.map(((e,t)=>(0,I.jsx)(U.A,{color:e.rest_day?"green":"blue",children:e.rest_day?"\u0130zin":e.shift_name},t)))})},{title:"\u0130\u015flemler",render:(e,t)=>(0,I.jsxs)(y.A,{children:[(0,I.jsx)(A.Ay,{icon:(0,I.jsx)(X.A,{}),onClick:()=>(e=>{if(console.log("D\xfczenlenecek \u015eablon:",e),!e.patterns||0===e.patterns.length)return void i.Ay.error("Bu \u015fablonun deseni bulunamad\u0131");u(e);const t={name:e.name,department_id:e.department_id,is_rotation:e.is_rotation,rotation_days:e.rotation_days,shifts:e.patterns.map((e=>({shift_schedule_id:e.shift_schedule_id,is_rest_day:e.rest_day})))};x.setFieldsValue(t),o(!0)})(t)}),(0,I.jsx)(A.Ay,{icon:(0,I.jsx)(Y.A,{}),danger:!0,onClick:()=>(async e=>{try{await d.A.delete(`http://localhost:5001/api/shifts/templates/${e}`,k()),i.Ay.success("\u015eablon silindi"),b()}catch(t){i.Ay.error("\u015eablon silinirken hata olu\u015ftu")}})(t.id)}),(0,I.jsx)(A.Ay,{type:"primary",onClick:()=>(u(t),void h(!0)),children:"Uygula"})]})}];return(0,I.jsxs)("div",{children:[(0,I.jsx)(A.Ay,{type:"primary",icon:(0,I.jsx)(J.A,{}),onClick:()=>{u(null),x.resetFields(),o(!0)},style:{marginBottom:16},children:"Yeni \u015eablon"}),(0,I.jsx)(_.A,{columns:w,dataSource:s,rowKey:"id"}),(0,I.jsx)(m.A,{title:p?"\u015eablon D\xfczenle":"Yeni \u015eablon",open:l,onCancel:()=>{o(!1),u(null),x.resetFields()},footer:null,width:800,children:(0,I.jsxs)(E.A,{form:x,onFinish:S,layout:"vertical",children:[(0,I.jsx)(E.A.Item,{name:"name",label:"\u015eablon Ad\u0131",rules:[{required:!0}],children:(0,I.jsx)(N.A,{})}),(0,I.jsx)(E.A.Item,{name:"department_id",label:"Departman",rules:[{required:!0}],children:(0,I.jsx)(f.A,{children:t.map((e=>(0,I.jsx)(ne,{value:e.id,children:e.name},e.id)))})}),(0,I.jsx)(E.A.Item,{name:"is_rotation",label:"Rotasyonlu Vardiya",valuePropName:"checked",children:(0,I.jsx)(q.A,{})}),(0,I.jsx)(E.A.Item,{noStyle:!0,shouldUpdate:(e,t)=>e.is_rotation!==t.is_rotation,children:e=>{let{getFieldValue:t}=e;return t("is_rotation")&&(0,I.jsx)(E.A.Item,{name:"rotation_days",label:"Rotasyon G\xfcn\xfc",rules:[{required:!0}],children:(0,I.jsx)(j.A,{min:1,max:31})})}}),(0,I.jsx)(E.A.List,{name:"shifts",children:(e,t)=>{let{add:r,remove:s}=t;return(0,I.jsxs)(I.Fragment,{children:[e.map(((e,t)=>(0,I.jsxs)(y.A,{align:"baseline",children:[(0,I.jsx)(E.A.Item,{name:[e.name,"shift_schedule_id"],fieldKey:[e.fieldKey,"shift_schedule_id"],label:`G\xfcn ${t+1}`,children:(0,I.jsx)(f.A,{style:{width:200},disabled:x.getFieldValue(["shifts",e.name,"is_rest_day"]),children:a.map((e=>(0,I.jsxs)(ne,{value:e.id,children:[e.name," (",e.start_time,"-",e.end_time,")"]},e.id)))})},`shift_schedule_${e.key}`),(0,I.jsx)(E.A.Item,{name:[e.name,"is_rest_day"],fieldKey:[e.fieldKey,"is_rest_day"],valuePropName:"checked",children:(0,I.jsx)(q.A,{checkedChildren:"\u0130zin",unCheckedChildren:"Vardiya",onChange:t=>{t&&x.setFieldsValue({shifts:{[e.name]:{shift_schedule_id:null}}})}})},`is_rest_day_${e.key}`),(0,I.jsx)(A.Ay,{onClick:()=>s(e.name),type:"text",danger:!0,children:"Sil"})]},e.key))),(0,I.jsx)(A.Ay,{type:"dashed",onClick:()=>r(),block:!0,icon:(0,I.jsx)(J.A,{}),children:"G\xfcn Ekle"})]})}}),(0,I.jsx)(E.A.Item,{children:(0,I.jsx)(A.Ay,{type:"primary",htmlType:"submit",children:p?"G\xfcncelle":"Kaydet"})})]})}),(0,I.jsx)(se,{visible:c,onCancel:()=>{h(!1),u(null)},onComplete:()=>{h(!1),u(null),i.Ay.success("\u015eablon ba\u015far\u0131yla uyguland\u0131"),b()},template:p,departmentId:null===p||void 0===p?void 0:p.department_id})]})},{Option:le}=f.A,oe="http://localhost:5001",de=e=>{let{departments:t,shiftSchedules:a}=e;const[s,l]=(0,r.useState)([]),[o,c]=(0,r.useState)(!1),[h,p]=(0,r.useState)(null),[u,g]=(0,r.useState)(!1),[j,k]=(0,r.useState)([]),[S]=E.A.useForm();(0,r.useEffect)((()=>{$()}),[]),(0,r.useEffect)((()=>{S.getFieldValue("department_id")&&D(S.getFieldValue("department_id"))}),[S.getFieldValue("department_id")]);const w=()=>({headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),$=async()=>{try{g(!0);const e=await d.A.get(`${oe}/api/shifts/groups`,w());l(e.data)}catch(e){i.Ay.error("Gruplar y\xfcklenirken hata olu\u015ftu")}finally{g(!1)}},D=async e=>{try{const t=await d.A.get(`${oe}/api/shifts/department-personnel/${e}`,w());k(t.data)}catch(t){i.Ay.error("Personel listesi al\u0131n\u0131rken hata olu\u015ftu")}},C=[{title:"Grup Ad\u0131",dataIndex:"name"},{title:"Departman",dataIndex:"department_name"},{title:"Personel",dataIndex:"members",render:e=>(0,I.jsx)("div",{style:{maxWidth:300,overflow:"hidden"},children:null===e||void 0===e?void 0:e.map(((e,t)=>(0,I.jsx)(U.A,{children:`${e.first_name} ${e.last_name}`},t)))})},{title:"\u0130\u015flemler",render:(e,t)=>(0,I.jsxs)(y.A,{children:[(0,I.jsx)(A.Ay,{icon:(0,I.jsx)(X.A,{}),onClick:()=>(e=>{var t;p(e),S.setFieldsValue({...e,rotation_start_date:e.rotation_start_date?n()(e.rotation_start_date):null,personnel_ids:null===(t=e.members)||void 0===t?void 0:t.map((e=>e.id))}),e.department_id&&D(e.department_id),c(!0)})(t)}),(0,I.jsx)(A.Ay,{icon:(0,I.jsx)(Y.A,{}),danger:!0,onClick:()=>(async e=>{try{await d.A.delete(`${oe}/api/shifts/groups/${e}`,w()),i.Ay.success("Grup ba\u015far\u0131yla silindi"),$()}catch(t){i.Ay.error("Grup silinirken hata olu\u015ftu")}})(t.id)})]})}];return(0,I.jsxs)("div",{children:[(0,I.jsx)(A.Ay,{type:"primary",icon:(0,I.jsx)(J.A,{}),onClick:()=>{p(null),S.resetFields(),c(!0)},style:{marginBottom:16},children:"Yeni Grup"}),(0,I.jsx)(_.A,{columns:C,dataSource:s,rowKey:"id",loading:u,expandable:{expandedRowRender:e=>{var t;return(0,I.jsx)(v.A,{size:"small",children:(0,I.jsxs)("div",{style:{marginTop:16},children:[(0,I.jsx)("strong",{children:"Grup \xdcyeleri:"}),(0,I.jsx)("div",{style:{marginTop:8},children:null===(t=e.members)||void 0===t?void 0:t.map(((e,t)=>(0,I.jsx)(v.A.Grid,{style:{width:"25%",textAlign:"center"},children:(0,I.jsxs)(y.A,{direction:"vertical",size:"small",children:[(0,I.jsx)(b.A,{style:{fontSize:"24px"}}),(0,I.jsxs)("div",{children:[e.first_name," ",e.last_name]}),(0,I.jsxs)(U.A,{color:"blue",children:["Ba\u015flang\u0131\xe7: Pattern ",e.start_pattern_index+1]})]})},e.personnel_id)))})]})})}}}),(0,I.jsx)(m.A,{title:h?"Grup D\xfczenle":"Yeni Grup",open:o,onCancel:()=>{c(!1),p(null),S.resetFields()},footer:null,children:(0,I.jsxs)(E.A,{form:S,onFinish:async e=>{try{var t;g(!0);const a={...e,rotation_start_date:null===(t=e.rotation_start_date)||void 0===t?void 0:t.format("YYYY-MM-DD")};null!==h&&void 0!==h&&h.id?(await d.A.put(`${oe}/api/shifts/groups/${h.id}`,a,w()),i.Ay.success("Grup ba\u015far\u0131yla g\xfcncellendi")):(await d.A.post(`${oe}/api/shifts/groups`,a,w()),i.Ay.success("Grup ba\u015far\u0131yla olu\u015fturuldu")),c(!1),S.resetFields(),$()}catch(a){console.error("Error saving group:",a),i.Ay.error("Grup kaydedilirken hata olu\u015ftu")}finally{g(!1)}},layout:"vertical",children:[(0,I.jsx)(E.A.Item,{name:"name",label:"Grup Ad\u0131",rules:[{required:!0}],children:(0,I.jsx)(N.A,{})}),(0,I.jsx)(E.A.Item,{name:"department_id",label:"Departman",rules:[{required:!0}],children:(0,I.jsx)(f.A,{onChange:e=>{S.setFieldsValue({personnel_ids:[]}),e&&D(e)},children:t.map((e=>(0,I.jsx)(le,{value:e.id,children:e.name},e.id)))})}),(0,I.jsx)(E.A.Item,{name:"personnel_ids",label:"Personel",rules:[{required:!0}],children:(0,I.jsx)(f.A,{mode:"multiple",placeholder:"Personel se\xe7in",style:{width:"100%"},showSearch:!0,optionFilterProp:"children",children:j.map((e=>(0,I.jsx)(le,{value:e.id,children:`${e.first_name} ${e.last_name}`},e.id)))})}),(0,I.jsx)(E.A.Item,{name:"rotation_start_date",label:"Rotasyon Ba\u015flang\u0131\xe7 Tarihi",children:(0,I.jsx)(x.A,{style:{width:"100%"}})}),(0,I.jsx)(E.A.Item,{className:"text-right",children:(0,I.jsxs)(y.A,{children:[(0,I.jsx)(A.Ay,{onClick:()=>{c(!1),p(null),S.resetFields()},children:"\u0130ptal"}),(0,I.jsx)(A.Ay,{type:"primary",htmlType:"submit",loading:u,children:h?"G\xfcncelle":"Kaydet"})]})})]})})]})},ce=e=>{let{requests:t,isAdmin:a,onStatusChange:s,onRefresh:l}=e;const[o,c]=(0,r.useState)(n()()),[h,p]=(0,r.useState)(!1),[u,f]=(0,r.useState)(null),[g,j]=(0,r.useState)(null),[_]=E.A.useForm(),v=[...Array(7)].map(((e,t)=>o.startOf("week").add(t,"day"))),k=async(e,t)=>{await s(e,t),l()},b=e=>`${["Pzt","Sal","\xc7ar","Per","Cum","Cmt","Paz"][0===e.day()?6:e.day()-1]} ${e.format("DD/MM")}`;return(0,I.jsxs)("div",{children:[(0,I.jsx)(y.A,{style:{marginBottom:16},children:(0,I.jsx)(x.A,{picker:"week",value:o,onChange:c})}),(0,I.jsxs)("div",{style:{background:"#fff",padding:16,borderRadius:8,border:"1px solid #f0f0f0"},children:[(0,I.jsxs)("div",{style:{display:"flex",borderBottom:"1px solid #f0f0f0",fontWeight:"bold",padding:"8px 0"},children:[(0,I.jsx)("div",{style:{width:"16%",minWidth:"150px",borderRight:"1px solid #f0f0f0",padding:"8px"},children:"Personel"}),v.map((e=>(0,I.jsx)("div",{style:{width:`${12..toFixed(2)}%`,borderRight:"1px solid #f0f0f0",textAlign:"center",padding:"8px"},children:b(e)},e.format())))]}),Array.from(new Set(t.map((e=>e.personnel_id)))).map((e=>{const r=t.find((t=>t.personnel_id===e));return(0,I.jsxs)("div",{style:{display:"flex",borderBottom:"1px solid #f0f0f0",minHeight:"80px"},children:[(0,I.jsxs)("div",{style:{width:"16%",minWidth:"150px",borderRight:"1px solid #f0f0f0",padding:"8px",display:"flex",alignItems:"center"},children:[r.first_name," ",r.last_name]}),v.map((s=>{const i=((e,t)=>t.filter((t=>n()(t.leave_date).format("YYYY-MM-DD")===e.format("YYYY-MM-DD"))))(s,t.filter((t=>t.personnel_id===e)));return(0,I.jsx)("div",{style:{width:`${12..toFixed(2)}%`,borderRight:"1px solid #f0f0f0",padding:"4px",cursor:"pointer",minHeight:"80px",backgroundColor:s.isSame(g,"day")?"#f0f0f0":"inherit"},onClick:()=>((e,t)=>{f(e),j(t),p(!0)})(r,s),children:i.map((e=>(0,I.jsxs)(U.A,{color:"pending"===e.status?"gold":"approved"===e.status?"green":"red",style:{width:"100%",margin:"2px 0"},children:["pending"===e.status?"Beklemede":"approved"===e.status?"Onayland\u0131":"Reddedildi",a&&"pending"===e.status&&(0,I.jsxs)(y.A,{style:{float:"right"},children:[(0,I.jsx)(A.Ay,{size:"small",type:"link",onClick:t=>{t.stopPropagation(),k(e.id,"approved")},children:"Onayla"}),(0,I.jsx)(A.Ay,{size:"small",type:"link",danger:!0,onClick:t=>{t.stopPropagation(),k(e.id,"rejected")},children:"Reddet"})]})]},e.id)))},s.format())}))]},e)}))]}),(0,I.jsx)(m.A,{title:`\u0130zin Talebi Olu\u015ftur - ${null===u||void 0===u?void 0:u.first_name} ${null===u||void 0===u?void 0:u.last_name} (${null===g||void 0===g?void 0:g.format("DD/MM/YYYY")})`,open:h,onCancel:()=>{p(!1),_.resetFields()},footer:null,children:(0,I.jsxs)(E.A,{form:_,onFinish:async e=>{try{await d.A.post("http://localhost:5001/api/shifts/leave-requests",{leave_date:g.format("YYYY-MM-DD"),reason:e.reason},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),i.Ay.success("\u0130zin talebi ba\u015far\u0131yla olu\u015fturuldu"),p(!1),_.resetFields(),l()}catch(s){var t,a,r;null!==(t=s.response)&&void 0!==t&&null!==(a=t.data)&&void 0!==a&&null!==(r=a.error)&&void 0!==r&&r.includes("duplicate key value")?i.Ay.warning("Bu tarihe ait bir izin talebiniz zaten bulunmaktad\u0131r"):i.Ay.error("\u0130zin talebi olu\u015fturulurken hata olu\u015ftu")}},layout:"vertical",children:[(0,I.jsx)(E.A.Item,{name:"reason",label:"Sebep",rules:[{required:!0,message:"L\xfctfen izin sebebini belirtin"}],children:(0,I.jsx)(N.A.TextArea,{})}),(0,I.jsx)(E.A.Item,{children:(0,I.jsx)(A.Ay,{type:"primary",htmlType:"submit",children:"G\xf6nder"})})]})})]})},he=()=>{const[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)(!1),[n]=E.A.useForm(),[o,c]=(0,r.useState)(!1),[h,p]=(0,r.useState)(!1),[u,f]=(0,r.useState)("list");(0,r.useEffect)((()=>{j(),g()}),[]);const g=async()=>{try{const e=await d.A.get("http://localhost:5001/api/me",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});p(["admin","team_leader"].includes(e.data.role))}catch(e){console.error("Error checking role:",e)}},j=async()=>{try{const e=h?"/leave-requests":"/my-leave-requests",a=await d.A.get(`http://localhost:5001/api/shifts${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),r=await Promise.all(a.data.map((async e=>{try{const t=await d.A.get(`http://localhost:5001/api/personnel/${e.personnel_id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});return{...e,personnel_name:`${t.data.first_name} ${t.data.last_name}`}}catch(t){return{...e,personnel_name:`Personel ${e.personnel_id}`}}})));t(r)}catch(e){console.error("Veri \xe7ekme hatas\u0131:",e),i.Ay.error("\u0130zin talepleri y\xfcklenirken hata olu\u015ftu")}},v=async(e,t)=>{try{await d.A.put(`http://localhost:5001/api/shifts/leave-requests/${e}`,{status:t},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),i.Ay.success("\u0130zin talebi durumu g\xfcncellendi"),j()}catch(a){i.Ay.error("Durum g\xfcncellenirken hata olu\u015ftu")}},k=[{title:"Personel",key:"personnel",render:(e,t)=>`${t.first_name} ${t.last_name}`},{title:"Talep Tarihi",dataIndex:"request_date",key:"request_date",render:e=>new Date(e).toLocaleDateString("tr-TR")},{title:"\u0130zin Tarihi",dataIndex:"leave_date",key:"leave_date",render:e=>new Date(e).toLocaleDateString("tr-TR")},{title:"Sebep",dataIndex:"reason",key:"reason"},{title:"Durum",dataIndex:"status",key:"status",render:e=>(0,I.jsx)(U.A,{color:{pending:"gold",approve:"green",approved:"green",reject:"red",rejected:"red"}[e],children:{pending:"BEKLEMEDE",approve:"ONAYLANDI",approved:"ONAYLANDI",reject:"REDDED\u0130LD\u0130",rejected:"REDDED\u0130LD\u0130"}[e]})},h&&{title:"\u0130\u015flemler",key:"actions",render:(e,t)=>"pending"===t.status&&(0,I.jsxs)(y.A,{children:[(0,I.jsx)(A.Ay,{type:"primary",size:"small",onClick:()=>v(t.id,"approved"),children:"Onayla"}),(0,I.jsx)(A.Ay,{danger:!0,size:"small",onClick:()=>v(t.id,"rejected"),children:"Reddet"})]})}].filter(Boolean);return(0,I.jsxs)("div",{children:[(0,I.jsxs)(y.A,{style:{marginBottom:16},children:[(0,I.jsx)(A.Ay,{type:"primary",onClick:()=>s(!0),children:"Yeni \u0130zin Talebi"}),(0,I.jsxs)(l.Ay.Group,{value:u,onChange:e=>f(e.target.value),optionType:"button",children:[(0,I.jsx)(l.Ay.Button,{value:"list",children:"Liste"}),(0,I.jsx)(l.Ay.Button,{value:"calendar",children:"Takvim"})]})]}),"list"===u?(0,I.jsx)(_.A,{columns:k,dataSource:e,rowKey:"id"}):(0,I.jsx)(ce,{requests:e,isAdmin:h,onStatusChange:v,onRefresh:j}),(0,I.jsx)(m.A,{title:"\u0130zin Talebi Olu\u015ftur",open:a,onCancel:()=>{s(!1),n.resetFields()},footer:null,children:(0,I.jsxs)(E.A,{form:n,onFinish:async e=>{try{c(!0);const t=e.leave_date.format("YYYY-MM-DD");await d.A.post("http://localhost:5001/api/shifts/leave-requests",{leave_date:t,reason:e.reason},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),i.Ay.success("\u0130zin talebi ba\u015far\u0131yla olu\u015fturuldu"),s(!1),n.resetFields(),j()}catch(l){var t,a,r;null!==(t=l.response)&&void 0!==t&&null!==(a=t.data)&&void 0!==a&&null!==(r=a.error)&&void 0!==r&&r.includes("duplicate key value violates unique constraint")?i.Ay.warning("Bu tarihe ait bir izin talebiniz zaten bulunmaktad\u0131r"):i.Ay.error("\u0130zin talebi olu\u015fturulurken hata olu\u015ftu")}finally{c(!1)}},layout:"vertical",children:[(0,I.jsx)(E.A.Item,{name:"leave_date",label:"\u0130zin Tarihi",rules:[{required:!0,message:"L\xfctfen izin tarihi se\xe7in"}],children:(0,I.jsx)(x.A,{style:{width:"100%"}})}),(0,I.jsx)(E.A.Item,{name:"reason",label:"Sebep",rules:[{required:!0,message:"L\xfctfen izin sebebini belirtin"}],children:(0,I.jsx)(N.A.TextArea,{})}),(0,I.jsx)(E.A.Item,{children:(0,I.jsx)(A.Ay,{type:"primary",htmlType:"submit",loading:o,children:"G\xf6nder"})})]})})]})},pe=()=>{const[e,t]=(0,r.useState)("1"),[a,s]=(0,r.useState)([]),[c,h]=(0,r.useState)([]),[p,u]=(0,r.useState)(!1),[m,y]=(0,r.useState)(null),[f,x]=(0,r.useState)("weekly"),[A,g]=(0,r.useState)(""),[j,_]=(0,r.useState)(n()()),v=(0,r.useRef)();(0,r.useEffect)((()=>{b(),k()}),[]);const k=async()=>{try{const e=await d.A.get("http://localhost:5001/api/me",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});g(e.data.role)}catch(e){console.error("Error checking role:",e)}},b=async()=>{try{const e={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},[t,a]=await Promise.all([d.A.get("http://localhost:5001/api/departments",e),d.A.get("http://localhost:5001/api/shifts/shift-schedules",e)]);s(t.data),h(a.data)}catch(t){var e;console.error("Error fetching data:",t),401===(null===(e=t.response)||void 0===e?void 0:e.status)&&(localStorage.removeItem("token"),window.location.href="/login"),i.Ay.error("Veri y\xfcklenirken bir hata olu\u015ftu")}},S=e=>{y(e)},w=()=>{const e={departments:a,shiftSchedules:c,selectedDepartment:m,onDepartmentChange:S,onBulkAssign:()=>u(!0),viewDate:j,setViewDate:_};return"weekly"===f?(0,I.jsx)(T,{ref:v,...e}):(0,I.jsx)(B,{...e})};return(0,I.jsxs)("div",{style:{padding:"20px"},children:[(0,I.jsx)(o.A,{activeKey:e,onChange:t,items:(()=>{const e=[{key:"5",label:"\u0130zin Talepleri",children:(0,I.jsx)(he,{})}];return"admin"!==A&&"superadmin"!==A||e.push({key:"1",label:"Vardiya Takvimi",children:(0,I.jsxs)("div",{children:[(0,I.jsx)("div",{style:{marginBottom:16},children:(0,I.jsxs)(l.Ay.Group,{value:f,onChange:e=>x(e.target.value),style:{marginBottom:16},children:[(0,I.jsx)(l.Ay.Button,{value:"weekly",children:"Haftal\u0131k G\xf6r\xfcn\xfcm"}),(0,I.jsx)(l.Ay.Button,{value:"monthly",children:"Ayl\u0131k G\xf6r\xfcn\xfcm"})]})}),w()]})},{key:"2",label:"Vardiya \u015eablonlar\u0131",children:(0,I.jsx)(ie,{departments:a,shiftSchedules:c})},{key:"3",label:"Vardiya Gruplar\u0131",children:(0,I.jsx)(de,{departments:a,shiftSchedules:c})},{key:"4",label:"Vardiya Ayarlar\u0131",children:(0,I.jsx)(ee,{departments:a,onSettingsUpdate:b})}),e})()}),("admin"===A||"superadmin"===A)&&(0,I.jsx)(W,{visible:p,onCancel:()=>u(!1),onComplete:()=>{u(!1),i.Ay.success("Toplu vardiya atamas\u0131 ba\u015far\u0131yla tamamland\u0131"),v.current&&v.current.fetchWeeklyShifts()},departmentId:m,shiftSchedules:c})]})}}}]);