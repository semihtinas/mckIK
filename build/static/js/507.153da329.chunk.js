"use strict";(self.webpackChunkmuse_dashboard=self.webpackChunkmuse_dashboard||[]).push([[507],{5633:(e,a,t)=>{t.r(a),t.d(a,{ExpenseRequestForm:()=>y,default:()=>f});var r=t(9950),i=t(6025),n=t(3561),s=t(9654),l=t(5355),o=t(8576),c=t(6823),d=t(7465),m=t(8349),u=t(4414);const{Option:h}=i.A,p="http://localhost:5001/api/expenses-management",y=e=>{let{onSuccess:a}=e;const[t]=n.A.useForm(),[y,f]=(0,r.useState)(!1),[g,A]=(0,r.useState)([]),[x,k]=(0,r.useState)(!1),[b,j]=(0,r.useState)([]),[w,v]=(0,r.useState)([]),[z,S]=(0,r.useState)(null);(0,r.useEffect)((()=>{$(),L()}),[]);const $=async()=>{try{const e=await fetch(`${p}/categories`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!e.ok)throw new Error("Kategoriler y\xfcklenemedi");const a=await e.json();j(a)}catch(e){s.Ay.error("Kategoriler y\xfcklenirken hata olu\u015ftu")}},L=async()=>{try{const e=await fetch(`${p}/content-types`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!e.ok)throw new Error("D\xf6k\xfcman tipleri y\xfcklenemedi");const a=await e.json();v(a)}catch(e){s.Ay.error("D\xf6k\xfcman tipleri y\xfcklenirken hata olu\u015ftu")}},_=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.map((e=>{var t;const r="\xa0".repeat(4*a),i=[(0,u.jsxs)(h,{value:e.id,children:[r+e.name,e.budget_limit&&(0,u.jsxs)("span",{style:{float:"right",color:"#888"},children:["Limit: \u20ba",e.budget_limit.toLocaleString()]})]},e.id)];return(null===(t=e.children)||void 0===t?void 0:t.length)>0&&i.push(..._(e.children,a+1)),i}))};return(0,u.jsxs)(n.A,{form:t,onFinish:async e=>{try{f(!0);const r=new FormData;Object.keys(e).forEach((a=>{"files"!==a&&("amount"===a?r.append(a,parseFloat(e[a])):r.append(a,e[a]))}));e.content_type_id;g.forEach((e=>{r.append("files",e.originFileObj)}));const i=localStorage.getItem("token");if(!i)throw new Error("Oturum bilgisi bulunamad\u0131");const n=await fetch("http://localhost:5001/api/expenses",{method:"POST",headers:{Authorization:`Bearer ${i}`},body:r});if(!n.ok){const e=await n.json();throw new Error(e.error||"\u0130\u015flem ba\u015far\u0131s\u0131z")}s.Ay.success("Harcama talebi ba\u015far\u0131yla olu\u015fturuldu"),t.resetFields(),A([]),S(null),a&&a()}catch(r){console.error("Hata:",r),s.Ay.error(r.message)}finally{f(!1)}},layout:"vertical",className:"expense-request-form",children:[(0,u.jsx)(n.A.Item,{name:"title",label:"Harcama Ba\u015fl\u0131\u011f\u0131",rules:[{required:!0,message:"L\xfctfen harcama ba\u015fl\u0131\u011f\u0131 girin"}],children:(0,u.jsx)(l.A,{placeholder:"Harcama ba\u015fl\u0131\u011f\u0131n\u0131 girin"})}),(0,u.jsx)(n.A.Item,{name:"type",label:"Harcama Tipi",rules:[{required:!0,message:"L\xfctfen harcama tipini se\xe7in"}],children:(0,u.jsxs)(i.A,{placeholder:"Harcama tipini se\xe7in",children:[(0,u.jsx)(h,{value:"claim",children:"Ger\xe7ekle\u015fen Harcama"}),(0,u.jsx)(h,{value:"request",children:"Harcama Talebi"})]})}),(0,u.jsx)(n.A.Item,{name:"category_id",label:"Kategori",rules:[{required:!0,message:"L\xfctfen kategori se\xe7in"}],children:(0,u.jsx)(i.A,{placeholder:"Kategori se\xe7in",showSearch:!0,optionFilterProp:"children",filterOption:(e,a)=>{var t;return null===(t=a.children)||void 0===t?void 0:t.toString().toLowerCase().includes(e.toLowerCase())},children:_(b)})}),(0,u.jsx)(n.A.Item,{name:"amount",label:"Tutar",rules:[{required:!0,message:"L\xfctfen tutar girin"},{validator:async(e,a)=>!a||a<=0?Promise.reject("Tutar 0'dan b\xfcy\xfck olmal\u0131d\u0131r"):Promise.resolve()}],children:(0,u.jsx)(o.A,{style:{width:"100%"},min:.01,step:.01,precision:2,formatter:e=>`\u20ba ${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\u20ba\s?|(,*)/g,""),placeholder:"0.00"})}),(0,u.jsx)(n.A.Item,{name:"content_type_id",label:"D\xf6k\xfcman Tipi",rules:[{required:!0,message:"L\xfctfen d\xf6k\xfcman tipini se\xe7in"}],children:(0,u.jsx)(i.A,{placeholder:"D\xf6k\xfcman tipini se\xe7in",onChange:e=>{const a=w.find((a=>a.id===e));S(a),g.length>0&&(A([]),s.Ay.info("D\xf6k\xfcman tipi de\u011fi\u015fti\u011fi i\xe7in y\xfckl\xfc dosyalar temizlendi"))},children:w.map((e=>(0,u.jsxs)(h,{value:e.id,children:[e.name,(0,u.jsxs)("span",{style:{float:"right",color:"#888",fontSize:"12px"},children:["(",e.file_extensions.join(", "),")"]})]},e.id)))})}),(0,u.jsx)(n.A.Item,{name:"description",label:"A\xe7\u0131klama",rules:[{required:!0,message:"L\xfctfen a\xe7\u0131klama girin"}],children:(0,u.jsx)(l.A.TextArea,{rows:4,placeholder:"Harcama detaylar\u0131n\u0131 a\xe7\u0131klay\u0131n"})}),(0,u.jsx)(n.A.Item,{name:"files",label:"Belgeler",extra:z?`Desteklenen formatlar: ${z.file_extensions.join(", ")} - \n             Maksimum dosya boyutu: ${(z.max_file_size/1048576).toFixed(1)}MB`:"L\xfctfen \xf6nce d\xf6k\xfcman tipini se\xe7in",children:(0,u.jsxs)(c.A.Dragger,{multiple:!0,beforeUpload:()=>!1,fileList:g,onChange:async e=>{let{file:a,fileList:r}=e;const i=t.getFieldValue("content_type_id");if(i){if("removed"!==a.status){const e=await(async(e,a)=>{try{const t=await fetch(`${p}/content-types/${a}/validate?filename=${encodeURIComponent(e.name)}&filesize=${e.size}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)throw new Error("Dosya do\u011frulama hatas\u0131");const r=await t.json();return r.isValid.extension?r.isValid.size?!!r.isValid.active||(s.Ay.error(r.errors.active),!1):(s.Ay.error(r.errors.size),!1):(s.Ay.error(r.errors.extension),!1)}catch(t){return s.Ay.error("Dosya do\u011frulama ba\u015far\u0131s\u0131z"),!1}})(a,i);if(!e)return;a.type&&(a.type.startsWith("image/")||"application/pdf"===a.type)&&(async e=>{try{k(!0);const r=new FormData;r.append("file",e);const i=await fetch("http://localhost:5001/api/expenses/analyze-document",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:r});if(!i.ok)throw new Error("Analiz ba\u015far\u0131s\u0131z");const n=await i.json();var a;n.success&&(t.setFieldsValue({amount:n.data.amount,description:`Sat\u0131c\u0131: ${n.data.vendor||"Bilinmiyor"}\n${(null===(a=n.data.items)||void 0===a?void 0:a.map((e=>`${e.description}: ${e.amount} TL`)).join("\n"))||""}`}),s.Ay.success("Belge ba\u015far\u0131yla analiz edildi"))}catch(r){console.error("Analiz hatas\u0131:",r),s.Ay.error("Belge analizi ba\u015far\u0131s\u0131z oldu")}finally{k(!1)}})(a)}A(r)}else s.Ay.error("L\xfctfen \xf6nce d\xf6k\xfcman tipini se\xe7in")},disabled:!z,children:[(0,u.jsx)("p",{className:"ant-upload-drag-icon",children:(0,u.jsx)(m.A,{})}),(0,u.jsx)("p",{className:"ant-upload-text",children:"Dosyalar\u0131 buraya s\xfcr\xfckleyin veya se\xe7in"}),(0,u.jsx)("p",{className:"ant-upload-hint",children:x?"Dosya analiz ediliyor...":"PDF ve resim dosyalar\u0131 otomatik olarak analiz edilecektir"})]})}),(0,u.jsx)(n.A.Item,{children:(0,u.jsx)(d.Ay,{type:"primary",htmlType:"submit",loading:y,block:!0,children:"Harcama Talebini G\xf6nder"})})]})},f=y},8349:(e,a,t)=>{t.d(a,{A:()=>o});var r=t(8168),i=t(9950);const n={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"};var s=t(5085),l=function(e,a){return i.createElement(s.A,(0,r.A)({},e,{ref:a,icon:n}))};const o=i.forwardRef(l)},2413:(e,a,t)=>{t.d(a,{A:()=>i});var r=t(9950);function i(){const[,e]=r.useReducer((e=>e+1),0);return e}}}]);