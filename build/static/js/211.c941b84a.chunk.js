"use strict";(self.webpackChunkmuse_dashboard=self.webpackChunkmuse_dashboard||[]).push([[211],{1211:(e,a,t)=>{t.r(a),t.d(a,{ExpenseManagement:()=>J,default:()=>W});var n=t(9950),r=t(8902),l=t(3561),i=t(9654),s=t(6092),o=t(5398),c=t(7465),d=t(1203),m=t(7094),p=t(1988),h=t(2056),u=t(7293),y=t(6550),x=t(6004),A=t(2077),j=t(6025),g=t(5355),k=t(6823),f=t(2025),b=t(2835),w=t(4500),v=t(9130),S=t(7686),I=t(1967),$=t(7560),_=t(8411),z=t(8349),T=t(5633),D=t(2748),B=t(5621),F=t(8576),C=t(2460),E=t(7376),O=t(4513),L=t(1689),H=t(8750),K=t(7484),q=t(4159),N=t.n(q),P=t(4414);const{TabPane:Y}=r.A,{TextArea:G}=g.A,M=()=>{const[e,a]=(0,n.useState)([]),[t,r]=(0,n.useState)(null),[o,d]=(0,n.useState)(!1),[m,p]=(0,n.useState)(!1),[u,A]=(0,n.useState)([]),[f,b]=(0,n.useState)(!1),[w]=l.A.useForm();(0,n.useEffect)((()=>{v(),S()}),[]);const v=async()=>{try{const e=await fetch("http://localhost:5001/api/expenses-management/templates",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),t=await e.json();a(t)}catch(e){i.Ay.error("\u015eablonlar y\xfcklenirken hata olu\u015ftu")}},S=async()=>{try{const e=await fetch("http://localhost:5001/api/expenses-management/categories",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),a=await e.json();A(a)}catch(e){i.Ay.error("Kategoriler y\xfcklenirken hata olu\u015ftu")}},I=[{title:"\u015eablon Ad\u0131",dataIndex:"name",key:"name"},{title:"Kategori",dataIndex:"category_name",key:"category_name"},{title:"Toplam Tutar",dataIndex:"total_amount",key:"total_amount",render:e=>`\u20ba${e.toLocaleString()}`},{title:"Alt Kalemler",dataIndex:"items",key:"items",render:e=>(0,P.jsx)(x.A,{wrap:!0,children:(null===e||void 0===e?void 0:e.map(((e,a)=>(0,P.jsx)(D.A,{title:`${e.description}: \u20ba${e.amount.toLocaleString()}`,children:(0,P.jsx)(B.A,{color:"blue",children:e.description})},a))))||"Alt kalem yok"})},{title:"\u0130\u015flemler",key:"actions",render:(e,a)=>(0,P.jsxs)(x.A,{children:[(0,P.jsx)(c.Ay,{type:"primary",icon:(0,P.jsx)(E.A,{}),onClick:()=>{r(a),p(!0)},children:"Harcama Olu\u015ftur"}),(0,P.jsx)(c.Ay,{icon:(0,P.jsx)(O.A,{}),onClick:()=>{r(a),w.setFieldsValue(a),d(!0)},children:"D\xfczenle"}),(0,P.jsx)(c.Ay,{danger:!0,icon:(0,P.jsx)(L.A,{}),onClick:()=>handleDeleteTemplate(a.id),children:"Sil"})]})}];return(0,P.jsxs)("div",{children:[(0,P.jsx)(h.A,{title:"Sabit Gider \u015eablonlar\u0131",extra:(0,P.jsx)(c.Ay,{type:"primary",icon:(0,P.jsx)(H.A,{}),onClick:()=>{r(null),w.resetFields(),d(!0)},children:"Yeni \u015eablon"}),children:(0,P.jsx)(y.A,{dataSource:e||[],columns:I,rowKey:"id",locale:{emptyText:"Hen\xfcz \u015fablon olu\u015fturulmam\u0131\u015f"},pagination:{pageSize:10,total:null===e||void 0===e?void 0:e.length,showTotal:e=>`Toplam ${e} \u015fablon`}})}),(0,P.jsx)(s.A,{title:""+(t?"\u015eablonu D\xfczenle":"Yeni \u015eablon"),open:o,onCancel:()=>d(!1),footer:null,width:800,children:(0,P.jsxs)(l.A,{form:w,onFinish:async e=>{try{const a=t?`http://localhost:5001/api/expenses-management/templates/${t.id}`:"http://localhost:5001/api/expenses-management/templates",n=t?"PUT":"POST";if(!(await fetch(a,{method:n,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw new Error("\u0130\u015flem ba\u015far\u0131s\u0131z");i.Ay.success("\u015eablon "+(t?"g\xfcncellendi":"olu\u015fturuldu")),d(!1),w.resetFields(),v()}catch(a){i.Ay.error("\u0130\u015flem s\u0131ras\u0131nda hata olu\u015ftu")}},layout:"vertical",children:[(0,P.jsx)(l.A.Item,{name:"name",label:"\u015eablon Ad\u0131",rules:[{required:!0}],children:(0,P.jsx)(g.A,{placeholder:"\xd6rn: Ayl\u0131k Kira \xd6demesi"})}),(0,P.jsx)(l.A.Item,{name:"category_id",label:"Kategori",rules:[{required:!0}],children:(0,P.jsx)(j.A,{placeholder:"Kategori se\xe7in",children:u.map((e=>(0,P.jsx)(j.A.Option,{value:e.id,children:e.name},e.id)))})}),(0,P.jsx)(l.A.List,{name:"items",children:(e,a)=>{let{add:t,remove:n}=a;return(0,P.jsxs)(P.Fragment,{children:[e.map((e=>(0,P.jsxs)(x.A,{style:{display:"flex",marginBottom:8},children:[(0,P.jsx)(l.A.Item,{name:[e.name,"description"],rules:[{required:!0}],style:{flex:2},children:(0,P.jsx)(g.A,{placeholder:"Kalem a\xe7\u0131klamas\u0131"})}),(0,P.jsx)(l.A.Item,{name:[e.name,"amount"],rules:[{required:!0}],style:{flex:1},children:(0,P.jsx)(F.A,{placeholder:"Tutar",formatter:e=>`\u20ba ${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\u20ba\s?|(,*)/g,""),style:{width:"100%"}})}),(0,P.jsx)(K.A,{onClick:()=>n(e.name)})]},e.key))),(0,P.jsx)(l.A.Item,{children:(0,P.jsx)(c.Ay,{type:"dashed",onClick:()=>t(),block:!0,icon:(0,P.jsx)(H.A,{}),children:"Alt Kalem Ekle"})})]})}}),(0,P.jsx)(l.A.Item,{children:(0,P.jsx)(c.Ay,{type:"primary",htmlType:"submit",block:!0,children:t?"G\xfcncelle":"Kaydet"})})]})}),(0,P.jsx)(s.A,{title:"\u015eablondan Harcama Olu\u015ftur",open:m,onCancel:()=>p(!1),footer:null,width:800,children:(0,P.jsxs)(l.A,{form:w,onFinish:async e=>{try{var a;const n=new FormData;n.append("title",t.name),n.append("amount",t.total_amount),n.append("category_id",t.category_id),n.append("type","fixed"),n.append("payment_date",e.payment_date.format("YYYY-MM-DD")),n.append("payment_method",e.payment_method),n.append("description",e.description||""),n.append("sub_expenses",JSON.stringify(t.items)),null!==(a=e.files)&&void 0!==a&&a.fileList&&e.files.fileList.forEach((e=>{n.append("files",e.originFileObj)}));if(!(await fetch("http://localhost:5001/api/expenses",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:n})).ok)throw new Error("Harcama kaydedilemedi");i.Ay.success("Harcama ba\u015far\u0131yla olu\u015fturuldu"),p(!1),w.resetFields()}catch(n){i.Ay.error("Harcama olu\u015fturulurken hata olu\u015ftu")}},layout:"vertical",initialValues:{payment_date:N()()},children:[(0,P.jsx)(l.A.Item,{name:"payment_date",label:"\xd6deme Tarihi",rules:[{required:!0}],children:(0,P.jsx)(C.A,{style:{width:"100%"}})}),(0,P.jsx)(l.A.Item,{name:"payment_method",label:"\xd6deme Y\xf6ntemi",rules:[{required:!0}],children:(0,P.jsxs)(j.A,{children:[(0,P.jsx)(j.A.Option,{value:"cash",children:"Nakit"}),(0,P.jsx)(j.A.Option,{value:"bank",children:"Banka"}),(0,P.jsx)(j.A.Option,{value:"credit_card",children:"Kredi Kart\u0131"})]})}),(0,P.jsx)(l.A.Item,{name:"description",label:"Ek A\xe7\u0131klama",children:(0,P.jsx)(G,{rows:4})}),(0,P.jsx)(l.A.Item,{name:"files",label:"Belgeler",valuePropName:"file",children:(0,P.jsxs)(k.A.Dragger,{multiple:!0,beforeUpload:()=>!1,accept:".pdf,.jpg,.jpeg,.png",children:[(0,P.jsx)("p",{className:"ant-upload-drag-icon",children:(0,P.jsx)(z.A,{})}),(0,P.jsx)("p",{className:"ant-upload-text",children:"Dosyalar\u0131 buraya s\xfcr\xfckleyin veya t\u0131klay\u0131n"})]})}),(0,P.jsx)(l.A.Item,{children:(0,P.jsx)(c.Ay,{type:"primary",htmlType:"submit",block:!0,children:"Harcama Olu\u015ftur"})})]})})]})},{TabPane:R}=r.A,V="http://localhost:5001/api/expenses",U="http://localhost:5001",J=()=>{const[e,a]=(0,n.useState)([]),[t,D]=(0,n.useState)([]),[B,F]=(0,n.useState)({totalExpenses:0,pendingAmount:0,approvedAmount:0,rejectedAmount:0,monthlyChange:0}),[C,E]=(0,n.useState)({visible:!1,record:null}),[O,L]=(0,n.useState)(!1),[H]=l.A.useForm();(0,n.useEffect)((()=>{K()}),[]);const K=async()=>{try{await Promise.all([q(),N(),Y()])}catch(e){i.Ay.error("Veriler y\xfcklenirken hata olu\u015ftu")}},q=async()=>{try{const e=localStorage.getItem("token"),t=await fetch(`${V}`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error("Harcamalar y\xfcklenemedi");const n=await t.json();a(n)}catch(e){console.error("Harcama listesi hatas\u0131:",e)}},N=async()=>{try{const e=localStorage.getItem("token"),a=await fetch(`${V}?status=pending`,{headers:{Authorization:`Bearer ${e}`}});if(!a.ok)throw new Error("Bekleyen talepler y\xfcklenemedi");const t=await a.json();D(t)}catch(e){console.error("Bekleyen talepler hatas\u0131:",e)}},Y=async()=>{try{const e=localStorage.getItem("token"),a=await fetch(`${V}/statistics`,{headers:{Authorization:`Bearer ${e}`}});if(!a.ok)throw new Error("\u0130statistikler y\xfcklenemedi");const t=await a.json();F({totalExpenses:t.total_expenses||0,pendingAmount:t.pending_amount||0,approvedAmount:t.approved_amount||0,rejectedAmount:t.rejected_amount||0,paidAmount:t.paid_amount||0,monthlyChange:t.monthly_change||0})}catch(e){console.error("\u0130statistik hatas\u0131:",e)}},G=async(e,a)=>{try{const t=localStorage.getItem("token"),n=await fetch(`${V}/${e}/status`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({status:a,reason:"Harcama "+("approved"===a?"onayland\u0131":"reddedildi")})});if(!n.ok){const e=await n.json();throw new Error(e.details||"Durum g\xfcncellenemedi")}i.Ay.success("Talep "+("approved"===a?"onayland\u0131":"reddedildi")),K()}catch(t){console.error("Durum de\u011fi\u015ftirme hatas\u0131:",t),i.Ay.error(t.message)}},R=()=>(0,P.jsxs)("div",{className:"dashboard-content",children:[(0,P.jsxs)(m.A,{gutter:16,className:"mb-4",children:[(0,P.jsx)(p.A,{span:4,children:(0,P.jsx)(h.A,{children:(0,P.jsx)(u.A,{title:"Toplam Harcama",value:B.totalExpenses,prefix:"\u20ba",precision:2})})}),(0,P.jsx)(p.A,{span:4,children:(0,P.jsx)(h.A,{children:(0,P.jsx)(u.A,{title:"Onay Bekleyen",value:B.pendingAmount,prefix:"\u20ba",precision:2,valueStyle:{color:"#faad14"}})})}),(0,P.jsx)(p.A,{span:4,children:(0,P.jsx)(h.A,{children:(0,P.jsx)(u.A,{title:"Onaylanan",value:B.approvedAmount,prefix:"\u20ba",precision:2,valueStyle:{color:"#52c41a"}})})}),(0,P.jsx)(p.A,{span:4,children:(0,P.jsx)(h.A,{children:(0,P.jsx)(u.A,{title:"Reddedilen",value:B.rejectedAmount,prefix:"\u20ba",precision:2,valueStyle:{color:"#cf1322"}})})}),(0,P.jsx)(p.A,{span:4,children:(0,P.jsx)(h.A,{children:(0,P.jsx)(u.A,{title:"\xd6denen",value:B.paidAmount,prefix:"\u20ba",precision:2,valueStyle:{color:"#3f8600"}})})}),(0,P.jsx)(p.A,{span:4,children:(0,P.jsx)(h.A,{children:(0,P.jsx)(u.A,{title:"Ayl\u0131k De\u011fi\u015fim",value:B.monthlyChange,precision:2,prefix:(0,P.jsxs)(P.Fragment,{children:[B.monthlyChange>=0?(0,P.jsx)(S.A,{}):(0,P.jsx)(ArrowDownOutlined,{}),"\u20ba"]}),valueStyle:{color:B.monthlyChange>=0?"#3f8600":"#cf1322"}})})})]}),(0,P.jsx)(h.A,{title:"Onay Bekleyen Talepler",className:"mb-4",children:(0,P.jsx)(y.A,{dataSource:t,columns:J.pendingRequests,rowKey:"id",pagination:{pageSize:5},size:"small"})})]}),J={pendingRequests:[{title:"Personel",dataIndex:"personnel_name",key:"personnel_name"},{title:"Ba\u015fl\u0131k",dataIndex:"title",key:"title"},{title:"Tutar",dataIndex:"amount",key:"amount",render:e=>`\u20ba${e.toLocaleString()}`},{title:"Kategori",dataIndex:"category",key:"category"},{title:"\u0130\u015flemler",key:"actions",render:(e,a)=>(0,P.jsxs)(x.A,{children:[(0,P.jsx)(c.Ay,{type:"primary",size:"small",icon:(0,P.jsx)(I.A,{}),onClick:()=>G(a.id,"approved"),children:"Onayla"}),(0,P.jsx)(c.Ay,{danger:!0,size:"small",icon:(0,P.jsx)($.A,{}),onClick:()=>G(a.id,"rejected"),children:"Reddet"})]})}],allExpenses:[{title:"Personel",dataIndex:"personnel_name",key:"personnel_name"},{title:"Ba\u015fl\u0131k",dataIndex:"title",key:"title"},{title:"Tutar",dataIndex:"amount",key:"amount",render:e=>`\u20ba${e.toLocaleString()}`},{title:"Kategori",dataIndex:"category",key:"category"},{title:"Durum",dataIndex:"status",key:"status",render:e=>(0,P.jsx)(A.A,{status:"paid"===e?"success":"approved"===e?"processing":"rejected"===e?"error":"default",text:"paid"===e?"\xd6dendi":"approved"===e?"Onayland\u0131":"rejected"===e?"Reddedildi":"Bekliyor"})},{title:"\u0130\u015flemler",key:"actions",render:(e,a)=>(0,P.jsxs)(x.A,{children:["approved"===a.status&&(0,P.jsx)(c.Ay,{type:"primary",icon:(0,P.jsx)(_.A,{}),onClick:()=>E({visible:!0,record:a}),children:"\xd6de"}),(0,P.jsx)(c.Ay,{type:"link",onClick:()=>(async e=>{try{const a=localStorage.getItem("token"),t=await fetch(`${V}/${e.id}/files`,{headers:{Authorization:`Bearer ${a}`}});if(!t.ok)throw new Error("D\xf6k\xfcmanlar y\xfcklenirken hata olu\u015ftu");const n=await t.json();console.log("Al\u0131nan dosyalar:",n);const l=e=>{switch(e.split(".").pop().toLowerCase()){case"pdf":return(0,P.jsx)(f.A,{style:{fontSize:"24px",color:"#ff4d4f"}});case"jpg":case"jpeg":case"png":return(0,P.jsx)(b.A,{style:{fontSize:"24px",color:"#1890ff"}});case"xlsx":case"xls":return(0,P.jsx)(w.A,{style:{fontSize:"24px",color:"#52c41a"}});default:return(0,P.jsx)(v.A,{style:{fontSize:"24px"}})}},i=n.filter((e=>"request_document"===e.document_type)),m=n.filter((e=>"payment_document"===e.document_type));s.A.info({title:"Harcama D\xf6k\xfcmanlar\u0131",width:800,className:"document-modal",content:(0,P.jsx)("div",{style:{maxHeight:"70vh",overflow:"auto"},children:(0,P.jsxs)(r.A,{defaultActiveKey:"request",children:[(0,P.jsx)(r.A.TabPane,{tab:`Harcama Belgeleri (${i.length})`,children:i.length>0?(0,P.jsx)(o.A,{dataSource:i,renderItem:e=>(0,P.jsx)(o.A.Item,{actions:[(0,P.jsx)(c.Ay,{type:"link",onClick:()=>{const a=`${U}/uploads/expenses/requests/${e.filename}`;window.open(a)},children:"G\xf6r\xfcnt\xfcle"})],children:(0,P.jsx)(o.A.Item.Meta,{avatar:l(e.originalname),title:e.originalname,description:`Y\xfcklenme: ${new Date(e.uploaded_at).toLocaleString()}`})})}):(0,P.jsx)(d.A,{description:"Harcama belgesi yok"})},"request"),(0,P.jsx)(r.A.TabPane,{tab:`\xd6deme Belgeleri (${m.length})`,children:m.length>0?(0,P.jsx)(o.A,{dataSource:m,renderItem:e=>(0,P.jsx)(o.A.Item,{actions:[(0,P.jsx)(c.Ay,{type:"link",onClick:()=>{const a=`${U}/uploads/expenses/payments/${e.filename}`;window.open(a)},children:"G\xf6r\xfcnt\xfcle"})],children:(0,P.jsx)(o.A.Item.Meta,{avatar:l(e.originalname),title:e.originalname,description:`Y\xfcklenme: ${new Date(e.uploaded_at).toLocaleString()}`})})}):(0,P.jsx)(d.A,{description:"\xd6deme belgesi yok"})},"payment")]})}),okText:"Kapat"})}catch(a){console.error("D\xf6k\xfcman hatas\u0131:",a),i.Ay.error("D\xf6k\xfcmanlar y\xfcklenirken bir hata olu\u015ftu")}})(a),children:"D\xf6k\xfcmanlar"})]})}]};return(0,P.jsxs)("div",{className:"expense-management",children:[(0,P.jsx)(r.A,{defaultActiveKey:"1",items:[{key:"1",label:"\xd6zet",children:(0,P.jsx)(R,{})},{key:"2",label:"T\xfcm Harcamalar",children:(0,P.jsx)(y.A,{columns:J.allExpenses,dataSource:e,rowKey:"id"})},{key:"3",label:"Yeni Talep",children:(0,P.jsx)(T.ExpenseRequestForm,{onSuccess:K})},{key:"4",label:"Sabit Giderler",children:(0,P.jsx)(M,{})}]}),(0,P.jsx)(s.A,{title:"\xd6deme Yap",open:C.visible,onCancel:()=>{E({visible:!1,record:null}),H.resetFields()},footer:null,width:600,children:(0,P.jsxs)(l.A,{form:H,onFinish:async e=>{try{L(!0);const a=localStorage.getItem("token"),t=new FormData;t.append("payment_method",e.payment_method),t.append("description",e.description||""),e.files&&e.files.fileList.forEach((e=>{t.append("files",e.originFileObj)}));const n=await fetch(`${V}/${C.record.id}/pay`,{method:"POST",headers:{Authorization:`Bearer ${a}`},body:t});if(!n.ok){const e=await n.json();throw new Error(e.message||"\xd6deme i\u015flemi ba\u015far\u0131s\u0131z")}i.Ay.success("\xd6deme ba\u015far\u0131yla tamamland\u0131"),E({visible:!1,record:null}),H.resetFields(),K()}catch(a){i.Ay.error(a.message)}finally{L(!1)}},layout:"vertical",children:[(0,P.jsx)(l.A.Item,{name:"payment_method",label:"\xd6deme Y\xf6ntemi",rules:[{required:!0,message:"L\xfctfen \xf6deme y\xf6ntemi se\xe7in"}],children:(0,P.jsxs)(j.A,{children:[(0,P.jsx)(j.A.Option,{value:"cash",children:"Nakit"}),(0,P.jsx)(j.A.Option,{value:"bank",children:"Banka"}),(0,P.jsx)(j.A.Option,{value:"credit_card",children:"Kredi Kart\u0131"})]})}),(0,P.jsx)(l.A.Item,{name:"description",label:"A\xe7\u0131klama",children:(0,P.jsx)(g.A.TextArea,{rows:4,placeholder:"\xd6deme ile ilgili notlar..."})}),(0,P.jsx)(l.A.Item,{name:"files",label:"\xd6deme Belgesi",valuePropName:"file",extra:"Dekont, fi\u015f vb. belgeler ekleyebilirsiniz",children:(0,P.jsxs)(k.A.Dragger,{multiple:!0,beforeUpload:()=>!1,accept:".pdf,.jpg,.jpeg,.png",maxCount:5,children:[(0,P.jsx)("p",{className:"ant-upload-drag-icon",children:(0,P.jsx)(z.A,{})}),(0,P.jsx)("p",{className:"ant-upload-text",children:"Dosya y\xfcklemek i\xe7in t\u0131klay\u0131n veya s\xfcr\xfckleyin"}),(0,P.jsx)("p",{className:"ant-upload-hint",children:"PDF, JPG, PNG formatlar\u0131n\u0131 destekler (Maks. 5 dosya)"})]})}),(0,P.jsx)(l.A.Item,{className:"text-right",children:(0,P.jsxs)(x.A,{children:[(0,P.jsx)(c.Ay,{onClick:()=>{E({visible:!1,record:null}),H.resetFields()},children:"\u0130ptal"}),(0,P.jsx)(c.Ay,{type:"primary",htmlType:"submit",loading:O,children:"\xd6demeyi Tamamla"})]})})]})})]})},W=J},5633:(e,a,t)=>{t.r(a),t.d(a,{ExpenseRequestForm:()=>y,default:()=>x});var n=t(9950),r=t(6025),l=t(3561),i=t(9654),s=t(5355),o=t(8576),c=t(6823),d=t(7465),m=t(8349),p=t(4414);const{Option:h}=r.A,u="http://localhost:5001/api/expenses-management",y=e=>{let{onSuccess:a}=e;const[t]=l.A.useForm(),[y,x]=(0,n.useState)(!1),[A,j]=(0,n.useState)([]),[g,k]=(0,n.useState)(!1),[f,b]=(0,n.useState)([]),[w,v]=(0,n.useState)([]),[S,I]=(0,n.useState)(null);(0,n.useEffect)((()=>{$(),_()}),[]);const $=async()=>{try{const e=await fetch(`${u}/categories`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!e.ok)throw new Error("Kategoriler y\xfcklenemedi");const a=await e.json();b(a)}catch(e){i.Ay.error("Kategoriler y\xfcklenirken hata olu\u015ftu")}},_=async()=>{try{const e=await fetch(`${u}/content-types`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!e.ok)throw new Error("D\xf6k\xfcman tipleri y\xfcklenemedi");const a=await e.json();v(a)}catch(e){i.Ay.error("D\xf6k\xfcman tipleri y\xfcklenirken hata olu\u015ftu")}},z=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.map((e=>{var t;const n="\xa0".repeat(4*a),r=[(0,p.jsxs)(h,{value:e.id,children:[n+e.name,e.budget_limit&&(0,p.jsxs)("span",{style:{float:"right",color:"#888"},children:["Limit: \u20ba",e.budget_limit.toLocaleString()]})]},e.id)];return(null===(t=e.children)||void 0===t?void 0:t.length)>0&&r.push(...z(e.children,a+1)),r}))};return(0,p.jsxs)(l.A,{form:t,onFinish:async e=>{try{x(!0);const n=new FormData;Object.keys(e).forEach((a=>{"files"!==a&&("amount"===a?n.append(a,parseFloat(e[a])):n.append(a,e[a]))}));e.content_type_id;A.forEach((e=>{n.append("files",e.originFileObj)}));const r=localStorage.getItem("token");if(!r)throw new Error("Oturum bilgisi bulunamad\u0131");const l=await fetch("http://localhost:5001/api/expenses",{method:"POST",headers:{Authorization:`Bearer ${r}`},body:n});if(!l.ok){const e=await l.json();throw new Error(e.error||"\u0130\u015flem ba\u015far\u0131s\u0131z")}i.Ay.success("Harcama talebi ba\u015far\u0131yla olu\u015fturuldu"),t.resetFields(),j([]),I(null),a&&a()}catch(n){console.error("Hata:",n),i.Ay.error(n.message)}finally{x(!1)}},layout:"vertical",className:"expense-request-form",children:[(0,p.jsx)(l.A.Item,{name:"title",label:"Harcama Ba\u015fl\u0131\u011f\u0131",rules:[{required:!0,message:"L\xfctfen harcama ba\u015fl\u0131\u011f\u0131 girin"}],children:(0,p.jsx)(s.A,{placeholder:"Harcama ba\u015fl\u0131\u011f\u0131n\u0131 girin"})}),(0,p.jsx)(l.A.Item,{name:"type",label:"Harcama Tipi",rules:[{required:!0,message:"L\xfctfen harcama tipini se\xe7in"}],children:(0,p.jsxs)(r.A,{placeholder:"Harcama tipini se\xe7in",children:[(0,p.jsx)(h,{value:"claim",children:"Ger\xe7ekle\u015fen Harcama"}),(0,p.jsx)(h,{value:"request",children:"Harcama Talebi"})]})}),(0,p.jsx)(l.A.Item,{name:"category_id",label:"Kategori",rules:[{required:!0,message:"L\xfctfen kategori se\xe7in"}],children:(0,p.jsx)(r.A,{placeholder:"Kategori se\xe7in",showSearch:!0,optionFilterProp:"children",filterOption:(e,a)=>{var t;return null===(t=a.children)||void 0===t?void 0:t.toString().toLowerCase().includes(e.toLowerCase())},children:z(f)})}),(0,p.jsx)(l.A.Item,{name:"amount",label:"Tutar",rules:[{required:!0,message:"L\xfctfen tutar girin"},{validator:async(e,a)=>!a||a<=0?Promise.reject("Tutar 0'dan b\xfcy\xfck olmal\u0131d\u0131r"):Promise.resolve()}],children:(0,p.jsx)(o.A,{style:{width:"100%"},min:.01,step:.01,precision:2,formatter:e=>`\u20ba ${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:e=>e.replace(/\u20ba\s?|(,*)/g,""),placeholder:"0.00"})}),(0,p.jsx)(l.A.Item,{name:"content_type_id",label:"D\xf6k\xfcman Tipi",rules:[{required:!0,message:"L\xfctfen d\xf6k\xfcman tipini se\xe7in"}],children:(0,p.jsx)(r.A,{placeholder:"D\xf6k\xfcman tipini se\xe7in",onChange:e=>{const a=w.find((a=>a.id===e));I(a),A.length>0&&(j([]),i.Ay.info("D\xf6k\xfcman tipi de\u011fi\u015fti\u011fi i\xe7in y\xfckl\xfc dosyalar temizlendi"))},children:w.map((e=>(0,p.jsxs)(h,{value:e.id,children:[e.name,(0,p.jsxs)("span",{style:{float:"right",color:"#888",fontSize:"12px"},children:["(",e.file_extensions.join(", "),")"]})]},e.id)))})}),(0,p.jsx)(l.A.Item,{name:"description",label:"A\xe7\u0131klama",rules:[{required:!0,message:"L\xfctfen a\xe7\u0131klama girin"}],children:(0,p.jsx)(s.A.TextArea,{rows:4,placeholder:"Harcama detaylar\u0131n\u0131 a\xe7\u0131klay\u0131n"})}),(0,p.jsx)(l.A.Item,{name:"files",label:"Belgeler",extra:S?`Desteklenen formatlar: ${S.file_extensions.join(", ")} - \n             Maksimum dosya boyutu: ${(S.max_file_size/1048576).toFixed(1)}MB`:"L\xfctfen \xf6nce d\xf6k\xfcman tipini se\xe7in",children:(0,p.jsxs)(c.A.Dragger,{multiple:!0,beforeUpload:()=>!1,fileList:A,onChange:async e=>{let{file:a,fileList:n}=e;const r=t.getFieldValue("content_type_id");if(r){if("removed"!==a.status){const e=await(async(e,a)=>{try{const t=await fetch(`${u}/content-types/${a}/validate?filename=${encodeURIComponent(e.name)}&filesize=${e.size}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)throw new Error("Dosya do\u011frulama hatas\u0131");const n=await t.json();return n.isValid.extension?n.isValid.size?!!n.isValid.active||(i.Ay.error(n.errors.active),!1):(i.Ay.error(n.errors.size),!1):(i.Ay.error(n.errors.extension),!1)}catch(t){return i.Ay.error("Dosya do\u011frulama ba\u015far\u0131s\u0131z"),!1}})(a,r);if(!e)return;a.type&&(a.type.startsWith("image/")||"application/pdf"===a.type)&&(async e=>{try{k(!0);const n=new FormData;n.append("file",e);const r=await fetch("http://localhost:5001/api/expenses/analyze-document",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:n});if(!r.ok)throw new Error("Analiz ba\u015far\u0131s\u0131z");const l=await r.json();var a;l.success&&(t.setFieldsValue({amount:l.data.amount,description:`Sat\u0131c\u0131: ${l.data.vendor||"Bilinmiyor"}\n${(null===(a=l.data.items)||void 0===a?void 0:a.map((e=>`${e.description}: ${e.amount} TL`)).join("\n"))||""}`}),i.Ay.success("Belge ba\u015far\u0131yla analiz edildi"))}catch(n){console.error("Analiz hatas\u0131:",n),i.Ay.error("Belge analizi ba\u015far\u0131s\u0131z oldu")}finally{k(!1)}})(a)}j(n)}else i.Ay.error("L\xfctfen \xf6nce d\xf6k\xfcman tipini se\xe7in")},disabled:!S,children:[(0,p.jsx)("p",{className:"ant-upload-drag-icon",children:(0,p.jsx)(m.A,{})}),(0,p.jsx)("p",{className:"ant-upload-text",children:"Dosyalar\u0131 buraya s\xfcr\xfckleyin veya se\xe7in"}),(0,p.jsx)("p",{className:"ant-upload-hint",children:g?"Dosya analiz ediliyor...":"PDF ve resim dosyalar\u0131 otomatik olarak analiz edilecektir"})]})}),(0,p.jsx)(l.A.Item,{children:(0,p.jsx)(d.Ay,{type:"primary",htmlType:"submit",loading:y,block:!0,children:"Harcama Talebini G\xf6nder"})})]})},x=y}}]);