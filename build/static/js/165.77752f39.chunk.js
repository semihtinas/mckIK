"use strict";(self.webpackChunkmuse_dashboard=self.webpackChunkmuse_dashboard||[]).push([[165],{1165:(e,a,n)=>{n.r(a),n.d(a,{default:()=>D});var l=n(9950),r=n(9654),t=n(6092),i=n(7465),s=n(7094),o=n(1988),d=n(2056),c=n(6550),y=n(6004),u=n(2748),p=n(8902),h=n(5355),m=n(9246),_=n(9051),v=n.n(_),g=n(6025),x=n(3561),A=n(5621),j=n(5376),k=n(6895),f=n(8576),b=n(4414);const{Option:z}=g.A,Y=()=>{const[e]=x.A.useForm(),[a,n]=(0,l.useState)([]),[u,p]=(0,l.useState)([]),[_,Y]=(0,l.useState)([]),[w,S]=(0,l.useState)([]),[T,D]=(0,l.useState)(null),[I,M]=(0,l.useState)(!1),[C,B]=(0,l.useState)(!1),[P,O]=(0,l.useState)([]),[F,L]=(0,l.useState)(!0),[E,R]=(0,l.useState)(!1),$=m.A.create({baseURL:{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_URL||"http://localhost:5001",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});(0,l.useEffect)((()=>{(async()=>{L(!0);try{const[e,a]=await Promise.all([$.get("/api/departments"),$.get("/api/leave-management/new-leave-types")]);n(e.data),p(a.data)}catch(e){console.error("Initial data error:",e),r.Ay.error("Veriler y\xfcklenirken hata olu\u015ftu")}finally{L(!1)}})()}),[]);return F?(0,b.jsx)(d.A,{children:(0,b.jsxs)("div",{style:{textAlign:"center",padding:"50px"},children:[(0,b.jsx)(j.A,{size:"large"}),(0,b.jsx)("p",{children:"Veriler y\xfckleniyor..."})]})}):(0,b.jsxs)(d.A,{title:"Toplu \u0130zin Bakiyesi G\xfcncelleme",children:[(0,b.jsxs)(x.A,{form:e,layout:"vertical",onFinish:async a=>{M(!0);try{const n={...a,selected_personnel:E?a.selected_personnel:void 0},l=await $.post("/api/leave/bulk-leave-balance-update",n);r.Ay.success(l.data.message),e.resetFields(),B(!1),S([])}catch(t){var n,l;console.error("Submit error:",t),r.Ay.error("G\xfcncelleme s\u0131ras\u0131nda hata olu\u015ftu: "+((null===(n=t.response)||void 0===n||null===(l=n.data)||void 0===l?void 0:l.error)||t.message))}finally{M(!1)}},children:[(0,b.jsx)(x.A.Item,{name:"department_id",label:"Departman",rules:[{required:!0,message:"L\xfctfen departman se\xe7in"}],children:(0,b.jsx)(g.A,{placeholder:"Departman se\xe7in",onChange:async a=>{if(D(a),S([]),e.setFieldsValue({selected_personnel:[]}),a){M(!0);try{const e=await $.get(`/api/departments/${a}/personnel`);Y(e.data)}catch(t){var n,l;console.error("Personnel fetch error:",t),r.Ay.error("Personel listesi y\xfcklenemedi: "+((null===(n=t.response)||void 0===n||null===(l=n.data)||void 0===l?void 0:l.error)||t.message)),Y([])}finally{M(!1)}}else Y([])},allowClear:!0,loading:I,children:a.map((e=>(0,b.jsx)(z,{value:e.id||"",children:e.name},e.id)))})}),(0,b.jsx)(x.A.Item,{children:(0,b.jsxs)(s.A,{align:"middle",gutter:8,children:[(0,b.jsx)(o.A,{children:(0,b.jsx)(k.A,{checked:E,onChange:R})}),(0,b.jsx)(o.A,{children:"Belirli personel se\xe7"})]})}),E&&(0,b.jsx)(x.A.Item,{name:"selected_personnel",label:"Personel Se\xe7",rules:[{required:!0,message:"L\xfctfen en az bir personel se\xe7in"}],children:(0,b.jsx)(g.A,{mode:"multiple",placeholder:"Personel se\xe7in",onChange:e=>{S(e)},loading:I,optionFilterProp:"children",showSearch:!0,allowClear:!0,children:_.map((e=>(0,b.jsxs)(z,{value:e.id,children:[e.first_name," ",e.last_name]},e.id)))})}),(0,b.jsx)(x.A.Item,{name:"leave_type_id",label:"\u0130zin T\xfcr\xfc",rules:[{required:!0,message:"L\xfctfen izin t\xfcr\xfc se\xe7in"}],children:(0,b.jsx)(g.A,{placeholder:"\u0130zin t\xfcr\xfc se\xe7in",loading:I,children:u.map((e=>(0,b.jsx)(z,{value:e.id||"",children:e.name},e.id)))})}),(0,b.jsx)(x.A.Item,{name:"days_to_add",label:"Eklenecek G\xfcn Say\u0131s\u0131",rules:[{required:!0,message:"L\xfctfen g\xfcn say\u0131s\u0131 girin"}],children:(0,b.jsx)(f.A,{min:1})}),(0,b.jsx)(x.A.Item,{name:"reason",label:"G\xfcncelleme Nedeni",rules:[{required:!0,message:"L\xfctfen g\xfcncelleme nedeni girin"}],children:(0,b.jsx)(h.A.TextArea,{rows:4})}),(0,b.jsx)(x.A.Item,{children:(0,b.jsxs)(y.A,{children:[(0,b.jsx)(i.Ay,{type:"primary",onClick:async()=>{try{const a=await e.validateFields();M(!0);const n={...a,selected_personnel:E?a.selected_personnel:void 0},l=await $.post("/api/leave/preview-bulk-update",n);O(l.data),B(!0)}catch(l){var a,n;if(!l.errorFields)console.error("Preview error:",l),r.Ay.error("\xd6nizleme olu\u015fturulamad\u0131: "+((null===(a=l.response)||void 0===a||null===(n=a.data)||void 0===n?void 0:n.error)||l.message))}finally{M(!1)}},loading:I,children:"\xd6nizle"}),(0,b.jsx)(i.Ay,{type:"primary",htmlType:"submit",loading:I,children:"G\xfcncelle"}),(0,b.jsx)(i.Ay,{onClick:async()=>{try{const a=e.getFieldsValue();if(!a.department_id||!a.leave_type_id)return void r.Ay.warning("L\xfctfen departman ve izin t\xfcr\xfc se\xe7in");M(!0);const n=await $.get("/api/leave/verify-balance-update",{params:{department_id:a.department_id,leave_type_id:a.leave_type_id,selected_personnel:a.selected_personnel}});n.data&&n.data.length>0?t.A.info({title:"G\xfcncelleme Sonu\xe7lar\u0131",width:1e3,content:(0,b.jsx)("div",{style:{maxHeight:"500px",overflow:"auto"},children:(0,b.jsx)(c.A,{dataSource:n.data,rowKey:e=>`${e.id}-${e.log_created_at}`,columns:[{title:"Personel",dataIndex:"full_name",key:"full_name"},{title:"Toplam \u0130zin",dataIndex:"total_days",key:"total_days",render:e=>(0,b.jsx)(A.A,{color:"blue",children:e||0})},{title:"Kullan\u0131lan",dataIndex:"used_days",key:"used_days",render:e=>(0,b.jsx)(A.A,{color:"orange",children:e||0})},{title:"Kalan",key:"remaining",render:(e,a)=>(0,b.jsx)(A.A,{color:"green",children:(a.total_days||0)-(a.used_days||0)})},{title:"Son \u0130\u015flem",dataIndex:"last_action",key:"last_action",render:e=>(0,b.jsx)(A.A,{color:"purple",children:e})},{title:"Eklenen G\xfcn",dataIndex:"days_changed",key:"days_changed",render:e=>e?(0,b.jsxs)(A.A,{color:"green",children:["+",e]}):"-"},{title:"\u0130\u015flem Tarihi",dataIndex:"log_created_at",key:"log_created_at",render:e=>e?v()(e).format("DD.MM.YYYY HH:mm:ss"):"-"},{title:"Sebep",dataIndex:"reason",key:"reason",ellipsis:!0}],pagination:!1,size:"small"})})}):r.Ay.info("Bu parametrelerle herhangi bir g\xfcncelleme bulunamad\u0131")}catch(l){var a,n;console.error("Verification error:",l),r.Ay.error("G\xfcncelleme kontrol\xfc yap\u0131l\u0131rken hata olu\u015ftu: "+((null===(a=l.response)||void 0===a||null===(n=a.data)||void 0===n?void 0:n.error)||l.message))}finally{M(!1)}},children:"G\xfcncellemeyi Kontrol Et"})]})})]}),(0,b.jsx)(t.A,{title:"Bakiye G\xfcncelleme \xd6nizleme",open:C,onOk:()=>e.submit(),onCancel:()=>B(!1),width:800,children:(0,b.jsx)(c.A,{dataSource:P,rowKey:"id",columns:[{title:"Personel",dataIndex:"personnel_name",key:"personnel_name"},{title:"Mevcut Bakiye",dataIndex:"current_balance",key:"current_balance"},{title:"Yeni Bakiye",dataIndex:"new_balance",key:"new_balance",render:e=>(0,b.jsx)(A.A,{color:"green",children:e})}],pagination:!1,size:"small"})})]})};var w=n(2309),S=n(7866),T=n(2278);const D=()=>{const[e,a]=(0,l.useState)([]),[n,_]=(0,l.useState)([]),[g,x]=(0,l.useState)([]),[A,j]=(0,l.useState)([]),[k,f]=(0,l.useState)(null),[z,D]=(0,l.useState)(!1),[I,M]=(0,l.useState)(!1),[C,B]=(0,l.useState)(""),P=m.A.create({baseURL:"http://localhost:5001",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),O=async()=>{try{const[e,n,l]=await Promise.all([P.get("/api/leave/leaves/pending"),P.get("/api/leave/leaves/approved"),P.get("/api/leave/leaves/rejected")]);a(e.data),_(n.data),x(l.data)}catch(e){console.error("Fetch error:",e),r.Ay.error("\u0130zin talepleri y\xfcklenemedi")}};(0,l.useEffect)((()=>{O()}),[]);(0,l.useEffect)((()=>{P.interceptors.request.use((e=>(console.log("Starting Request:",e),e))),P.interceptors.response.use((e=>(console.log("Response:",e),e)),(e=>(console.log("Response Error:",e.response),Promise.reject(e))))}),[]);const F=function(){return[{title:"Personel Ad\u0131",dataIndex:"personnel_name",key:"personnel_name"},{title:"\u0130zin T\xfcr\xfc",dataIndex:"leave_type_name",key:"leave_type_name"},{title:"Ba\u015flang\u0131\xe7 Tarihi",dataIndex:"start_date",key:"start_date",render:e=>v()(e).format("DD.MM.YYYY")},{title:"Biti\u015f Tarihi",dataIndex:"end_date",key:"end_date",render:e=>v()(e).format("DD.MM.YYYY")},{title:"Durum",dataIndex:"status",key:"status"},...arguments.length>0&&void 0!==arguments[0]&&arguments[0]?[{title:"D\xfczenle",key:"action",render:(e,a)=>(0,b.jsx)(i.Ay,{type:"link",onClick:()=>(f(a),B(""),void D(!0)),children:"D\xfczenle"})}]:[]]},L=async()=>{try{r.Ay.loading({content:"\u0130zin bakiyeleri hesaplan\u0131yor...",key:"balanceUpdate"}),await P.post("/api/leave/leave-balance/update-all"),await E(),r.Ay.success({content:"\u0130zin bakiyeleri ba\u015far\u0131yla g\xfcncellendi",key:"balanceUpdate"})}catch(e){console.error("\u0130zin bakiyesi g\xfcncelleme hatas\u0131:",e),r.Ay.error({content:"\u0130zin bakiyeleri g\xfcncellenirken hata olu\u015ftu",key:"balanceUpdate"})}},E=async()=>{try{const e=await P.get("/api/leave/leave-balances/summary");j(e.data)}catch(e){console.error("\u0130zin bakiyeleri y\xfcklenirken hata:",e),r.Ay.error("\u0130zin bakiyeleri y\xfcklenemedi")}};(0,l.useEffect)((()=>{O(),E()}),[]);const R=[{title:"Personel Ad\u0131",dataIndex:"personnel_name",key:"personnel_name",fixed:"left",width:200,sorter:(e,a)=>e.personnel_name.localeCompare(a.personnel_name)},{title:"\u0130zin T\xfcr\xfc",dataIndex:"leave_type_name",key:"leave_type_name",width:150},{title:"Toplam Hak",dataIndex:"total_days",key:"total_days",width:120,render:e=>(0,b.jsx)("span",{style:{fontWeight:"bold"},children:e})},{title:"Kullan\u0131lan",dataIndex:"used_days",key:"used_days",width:120,render:e=>(0,b.jsx)("span",{style:{color:"#f5222d"},children:e||0})},{title:"Kalan",dataIndex:"remaining_days",key:"remaining_days",width:120,render:(e,a)=>(0,b.jsx)("span",{style:{color:a.total_days-a.used_days>0?"#52c41a":"#f5222d",fontWeight:"bold"},children:a.total_days-a.used_days})},{title:"Y\u0131l",dataIndex:"year",key:"year",width:100},{title:"Yenileme Bilgisi",dataIndex:"renewal_period_name",key:"renewal_period",width:150},{title:"Sonraki Yenileme",dataIndex:"calculated_next_renewal",key:"next_renewal",width:150,render:e=>e?v()(e).format("DD.MM.YYYY"):"-",sorter:(e,a)=>v()(e.calculated_next_renewal)-v()(a.calculated_next_renewal)}],$=e=>{let{data:a}=e;const n=[...new Set(a.map((e=>e.personnel_id)))],l=[...new Set(a.map((e=>e.leave_type_id)))];return(0,b.jsxs)(s.A,{gutter:16,style:{marginBottom:16},children:[(0,b.jsx)(o.A,{span:8,children:(0,b.jsxs)(d.A,{children:[(0,b.jsx)("h3",{children:"Toplam Personel"}),(0,b.jsx)("p",{style:{fontSize:"24px",fontWeight:"bold"},children:n.length})]})}),(0,b.jsx)(o.A,{span:8,children:(0,b.jsxs)(d.A,{children:[(0,b.jsx)("h3",{children:"\u0130zin T\xfcr\xfc Say\u0131s\u0131"}),(0,b.jsx)("p",{style:{fontSize:"24px",fontWeight:"bold"},children:l.length})]})}),(0,b.jsx)(o.A,{span:8,children:(0,b.jsxs)(d.A,{children:[(0,b.jsx)("h3",{children:"Toplam Aktif \u0130zin Kayd\u0131"}),(0,b.jsx)("p",{style:{fontSize:"24px",fontWeight:"bold"},children:a.length})]})})]})},K=[{key:"1",label:"Onay Bekleyen \u0130zinler",children:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.Ay,{type:"primary",onClick:()=>M(!0),style:{marginBottom:16},children:"Yeni \u0130zin Talebi"}),(0,b.jsx)(c.A,{dataSource:e,columns:F(!0),rowKey:"id"})]})},{key:"2",label:"Onaylanan \u0130zinler",children:(0,b.jsx)(c.A,{dataSource:n,columns:F(),rowKey:"id"})},{key:"3",label:"Onaylanmayan \u0130zinler",children:(0,b.jsx)(c.A,{dataSource:g,columns:F(),rowKey:"id"})},{key:"4",label:"\u0130zin Bakiyeleri",children:(0,b.jsxs)("div",{children:[(0,b.jsx)($,{data:A}),(0,b.jsx)(c.A,{dataSource:A,columns:R,rowKey:e=>`${e.personnel_id}-${e.leave_type_id}-${e.year}`,scroll:{x:"max-content"},pagination:{pageSize:10,showSizeChanger:!0,showTotal:(e,a)=>`${a[0]}-${a[1]} / ${e} kay\u0131t g\xf6steriliyor`},title:()=>(0,b.jsxs)(y.A,{children:[(0,b.jsx)(i.Ay,{type:"primary",onClick:L,icon:(0,b.jsx)(S.A,{}),children:"Bakiyeleri Yeniden Hesapla"}),(0,b.jsx)(u.A,{title:"T\xfcm personelin izin bakiyelerini yeni hesaplama mant\u0131\u011f\u0131na g\xf6re g\xfcnceller",children:(0,b.jsx)(T.A,{})})]})})]})},{key:"5",label:"Toplu \u0130zin \u0130\u015flemleri",children:(0,b.jsx)(Y,{})}];return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(p.A,{defaultActiveKey:"1",items:K}),(0,b.jsx)(t.A,{title:"\u0130zin Talebini D\xfczenle",open:z,onCancel:()=>{D(!1),f(null)},footer:[(0,b.jsx)(i.Ay,{danger:!0,onClick:async()=>{if(k)try{200===(await P.put(`/api/leave/leaves/${k.id}/reject`,{approval_reason:C||"Reddedildi"})).status&&(r.Ay.success("\u0130zin talebi reddedildi"),D(!1),O())}catch(n){var e,a;console.error("Red hatas\u0131:",n),r.Ay.error((null===(e=n.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.error)||"\u0130zin talebi reddedilemedi")}else r.Ay.error("Se\xe7ili izin talebi bulunamad\u0131")},disabled:!k,children:"Red"},"reject"),(0,b.jsx)(i.Ay,{type:"primary",onClick:()=>k&&(async e=>{try{console.log("Onaylama ba\u015flat\u0131l\u0131yor:",e);const a=await P.put(`/api/leave/leaves/${e}/approve`,{approval_reason:C||"Onayland\u0131",forceApprove:!1});if(console.log("\u0130lk onay yan\u0131t\u0131:",a),200===a.status)return r.Ay.success("\u0130zin talebi ba\u015far\u0131yla onayland\u0131"),O(),void D(!1)}catch(c){var a,n,l,i,s,o,d;console.log("Hata detay\u0131:",null===(a=c.response)||void 0===a?void 0:a.data),400===(null===(n=c.response)||void 0===n?void 0:n.status)?null!==(l=c.response.data)&&void 0!==l&&l.requiresConfirmation?t.A.confirm({title:"\u0130zin Bakiyesi Yetersiz",content:`${(null===(i=c.response.data)||void 0===i?void 0:i.error)||"\u0130zin bakiyesi yetersiz."} \n                     \u0130zni yine de onaylamak istiyor musunuz?`,okText:"Onayla",cancelText:"\u0130ptal",onOk:async()=>{try{console.log("Zorla onaylama ba\u015flat\u0131l\u0131yor");const a=await P.put(`/api/leave/leaves/${e}/approve`,{approval_reason:C||"Yetersiz bakiyeye ra\u011fmen onayland\u0131",forceApprove:!0});console.log("Zorla onaylama yan\u0131t\u0131:",a),200===a.status&&(r.Ay.success(a.data.message||"\u0130zin talebi yetersiz bakiyeye ra\u011fmen onayland\u0131"),O(),D(!1))}catch(t){var a,n,l;console.error("Zorla onaylama hatas\u0131:",null===(a=t.response)||void 0===a?void 0:a.data),r.Ay.error((null===(n=t.response)||void 0===n||null===(l=n.data)||void 0===l?void 0:l.error)||"\u0130zin onaylan\u0131rken bir hata olu\u015ftu")}},onCancel(){r.Ay.info("\u0130zin onaylama i\u015flemi iptal edildi")}}):r.Ay.error((null===(s=c.response.data)||void 0===s?void 0:s.error)||"\u0130zin onaylanamad\u0131"):(console.error("Onaylama hatas\u0131:",c),r.Ay.error((null===(o=c.response)||void 0===o||null===(d=o.data)||void 0===d?void 0:d.error)||"Sunucu hatas\u0131 olu\u015ftu"))}})(k.id),disabled:!k,children:"Onayla"},"approve")],children:k&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Personel:"})," ",k.personnel_name]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"\u0130zin T\xfcr\xfc:"})," ",k.leave_type_name]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Ba\u015flang\u0131\xe7:"})," ",v()(k.start_date).format("DD.MM.YYYY")]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Biti\u015f:"})," ",v()(k.end_date).format("DD.MM.YYYY")]}),(0,b.jsx)(h.A.TextArea,{value:C,onChange:e=>B(e.target.value),placeholder:"Onay/Red sebebi (opsiyonel)",rows:3})]})}),(0,b.jsx)(t.A,{title:"Yeni \u0130zin Talebi",open:I,onCancel:()=>M(!1),footer:null,width:800,children:(0,b.jsx)(w.default,{closeModal:()=>M(!1),onLeaveRequestSuccess:O,refreshData:O})})]})}},2309:(e,a,n)=>{n.r(a),n.d(a,{default:()=>x});var l=n(9950),r=n(6025),t=n(2460),i=n(3561),s=n(9654),o=n(6092),d=n(5355),c=n(7465),y=n(9246),u=n(4159),p=n.n(u),h=n(4028),m=n.n(h),_=n(4414);p().extend(m());const{Option:v}=r.A,{RangePicker:g}=t.A,x=e=>{var a;let{closeModal:n,onLeaveRequestSuccess:t,refreshData:u}=e;const[h,m]=(0,l.useState)([]),[x,A]=(0,l.useState)([]),[j]=i.A.useForm(),[k,f]=(0,l.useState)(0),[b,z]=(0,l.useState)(0),[Y,w]=(0,l.useState)(!1),[S,T]=(0,l.useState)({}),[D,I]=(0,l.useState)(null),[M,C]=(0,l.useState)([]),[B,P]=(0,l.useState)(0),O=y.A.create({baseURL:"http://localhost:5001",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});(0,l.useEffect)((()=>{(async()=>{try{var e;const n=await O.get("/api/me");if(I(n.data),null!==(e=n.data)&&void 0!==e&&e.id)try{const e=await O.get(`/api/leave/leave-balance/${n.data.id}`);console.log("Leave balance response:",e.data),C(e.data)}catch(a){console.error("Error fetching leave balance:",a),s.Ay.error("\u0130zin bakiyesi y\xfcklenirken hata olu\u015ftu")}const[l,r]=await Promise.all([O.get("/api/leave-management/new-leave-types"),O.get("/api/public-holidays")]);m(l.data),A(r.data.map((e=>p()(e.holiday_date))))}catch(a){console.error("Fetch error:",a),s.Ay.error("Veriler y\xfcklenirken hata olu\u015ftu")}})()}),[]),(0,l.useEffect)((()=>{null!==D&&void 0!==D&&D.id&&(async()=>{try{const e=await O.get("/api/leave/leave-balances/summary/normal",{params:{personnel_id:null===D||void 0===D?void 0:D.id}});P(e.data.total_remaining_days)}catch(e){console.log("Fetching leave balance for:",null===D||void 0===D?void 0:D.id),console.log("Request URL:","/api/leave/leave-balances/summary/normal"),console.error("Normal izin bakiyesi y\xfcklenirken hata:",e),s.Ay.error("\u0130zin bakiyesi y\xfcklenemedi")}})()}),[D]);return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsxs)(i.A,{form:j,layout:"vertical",onFinish:e=>{const a=e.date_range;if(!a||!a[0]||!a[1])return void s.Ay.error("L\xfctfen ge\xe7erli bir tarih aral\u0131\u011f\u0131 se\xe7in");null===D||void 0===D||D.id,e.leave_type_id,a[0].format("YYYY-MM-DD"),a[1].format("YYYY-MM-DD"),e.reason;(async()=>{try{const h=S.leave_type_id;if(!S.leave_type_id)return void s.Ay.error("L\xfctfen izin t\xfcr\xfcn\xfc se\xe7iniz");if(!S.start_date||!S.end_date)return void s.Ay.error("L\xfctfen tarih aral\u0131\u011f\u0131 se\xe7iniz");if(!h)return void s.Ay.error("L\xfctfen izin t\xfcr\xfcn\xfc se\xe7iniz.");try{const y=(await O.get(`/api/leave-management/new-leave-types/${h}`)).data;if(y.conditions&&y.conditions.length>0)try{await O.post("/api/leave/check-eligibility",{personnel_id:D.id,leave_type_id:h})}catch(d){var e,a;return void s.Ay.error((null===(e=d.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.error)||"\u0130zin ko\u015fullar\u0131 kar\u015f\u0131lanm\u0131yor")}const m={...S,personnel_id:D.id,start_date:p()(S.start_date).format("YYYY-MM-DD"),end_date:p()(S.end_date).format("YYYY-MM-DD"),status:"Pending",work_days:b,total_days:k};console.log("Formatted Values:",m);try{await O.post("/api/leave/check-balance",{personnel_id:D.id,leave_type_id:h,requested_days:b}),await O.post("/api/leave/leave-request",m),s.Ay.success("\u0130zin talebi ba\u015far\u0131yla olu\u015fturuldu"),j.resetFields(),t&&t(),n&&n(),u&&u()}catch(c){var l,r,i;400===(null===(l=c.response)||void 0===l?void 0:l.status)?o.A.confirm({title:"Yetersiz \u0130zin Bakiyesi",content:`${c.response.data.error}. \u0130zin talebini yine de g\xf6ndermek istiyor musunuz?`,okText:"G\xf6nder",cancelText:"Vazge\xe7",onOk:async()=>{try{await O.post("/api/leave/leave-request",{...m,force_approve:!0}),s.Ay.success("\u0130zin talebi ba\u015far\u0131yla olu\u015fturuldu"),j.resetFields(),t&&t(),n&&n(),u&&u()}catch(l){var e,a;s.Ay.error((null===(e=l.response)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.error)||"\u0130zin talebi olu\u015fturulurken hata olu\u015ftu")}}}):s.Ay.error((null===(r=c.response)||void 0===r||null===(i=r.data)||void 0===i?void 0:i.error)||"\u0130zin bakiyesi kontrol\xfcnde hata olu\u015ftu")}}catch(y){return console.error("Error fetching leave type details:",y),void s.Ay.error("\u0130zin t\xfcr\xfc bilgileri al\u0131n\u0131rken hata olu\u015ftu")}}catch(h){console.error("Error:",h),s.Ay.error("\u0130zin talebi i\u015flenirken bir hata olu\u015ftu")}})()},onValuesChange:(e,a)=>{e.leave_type_id&&T((a=>({...a,leave_type_id:e.leave_type_id}))),e.reason&&T((a=>({...a,reason:e.reason})))},children:[D&&(0,_.jsx)("div",{className:"mb-4 p-4 bg-gray-50 rounded",children:(0,_.jsxs)("p",{children:[(0,_.jsx)("strong",{children:"Personel:"})," ",D.first_name," ",D.last_name]})}),B>0&&(0,_.jsxs)("div",{className:"mb-4 p-4 bg-gray-50 rounded",children:[(0,_.jsx)("h4",{children:"Toplam \u0130zin Bakiyesi"}),(0,_.jsxs)("p",{children:[(0,_.jsx)("strong",{children:"Kalan G\xfcn:"})," ",B," g\xfcn"]})]}),(()=>{if(!M||!S.leave_type_id)return null;const e=M.find((e=>e.leave_type_id===S.leave_type_id));return e?(0,_.jsxs)("div",{className:"mb-4 p-4 bg-gray-50 rounded",children:[(0,_.jsx)("h4",{children:"\u0130zin Bakiyesi"}),(0,_.jsxs)("p",{children:["Toplam \u0130zin Hakk\u0131: ",e.total_days," g\xfcn"]}),(0,_.jsxs)("p",{children:["Kullan\u0131lan \u0130zin: ",e.used_days," g\xfcn"]}),(0,_.jsxs)("p",{children:["Kalan \u0130zin: ",e.remaining_days," g\xfcn"]})]}):null})(),(0,_.jsx)(i.A.Item,{name:"leave_type_id",label:"\u0130zin T\xfcr\xfc",rules:[{required:!0,message:"L\xfctfen izin t\xfcr\xfc se\xe7in"}],children:(0,_.jsx)(r.A,{placeholder:"\u0130zin t\xfcr\xfc se\xe7in",children:h.map((e=>(0,_.jsx)(v,{value:e.id,children:e.name},e.id)))})}),(0,_.jsx)(i.A.Item,{name:"date_range",label:"\u0130zin Tarihleri",rules:[{required:!0,message:"L\xfctfen izin tarihlerini se\xe7in"}],children:(0,_.jsx)(g,{style:{width:"100%"},format:"DD.MM.YYYY",disabledDate:e=>e&&e<p()().startOf("day"),placeholder:["Ba\u015flang\u0131\xe7 Tarihi","Biti\u015f Tarihi"],onChange:e=>{if(e){const[a,n]=e;if(a&&n){const e=((e,a)=>e&&a?a.diff(e,"days")+1:0)(a,n),l=((e,a,n)=>{let l=0,r=p()(e);for(;r.isSameOrBefore(a,"day");)0!==r.day()&&6!==r.day()&&(n.some((e=>e.isSame(r,"day")))||l++),r=r.add(1,"days");return l})(a,n,x);f(e),z(l),T((e=>({...e,start_date:a,end_date:n})))}}else f(0),z(0),T((e=>({...e,start_date:null,end_date:null})))}})}),(0,_.jsxs)(i.A.Item,{children:[(0,_.jsxs)("p",{children:[(0,_.jsx)("strong",{children:"Talep edilen izin g\xfcn say\u0131s\u0131:"})," ",k," g\xfcn"]}),(0,_.jsxs)("p",{children:[(0,_.jsx)("strong",{children:"\u0130zin hakk\u0131ndan d\xfc\u015f\xfclecek i\u015f g\xfcnleri:"})," ",b," g\xfcn"]})]}),(0,_.jsx)(i.A.Item,{name:"reason",label:"\u0130zin Nedeni",rules:[{required:!0,message:"L\xfctfen izin nedeni girin"}],children:(0,_.jsx)(d.A.TextArea,{rows:4,placeholder:"\u0130zin nedeni yaz\u0131n"})}),(0,_.jsx)(i.A.Item,{children:(0,_.jsx)(c.Ay,{type:"primary",htmlType:"submit",children:"Talep G\xf6nder"})})]}),(0,_.jsxs)(o.A,{title:"\u0130zin Talebini Onayla",open:Y,onOk:async()=>{try{const e={...S,personnel_id:D.id,start_date:S.start_date&&p()(S.start_date).isValid()?p()(S.start_date).format("YYYY-MM-DD"):null,end_date:S.end_date&&p()(S.end_date).isValid()?p()(S.end_date).format("YYYY-MM-DD"):null,status:"Pending",work_days:b,total_days:k};console.log("Sending work_days value:",e.work_days),console.log("Sending total_days value:",e.total_days),console.log("Formatted start_date:",p()(S.start_date).format("YYYY-MM-DD")),console.log("Formatted end_date:",p()(S.end_date).format("YYYY-MM-DD")),await O.post("/api/leave/leave-request",e),s.Ay.success("\u0130zin talebi ba\u015far\u0131yla olu\u015fturuldu"),j.resetFields(),w(!1),t&&t(),n&&n(),u&&u()}catch(e){console.error("Submit error:",e),s.Ay.error("\u0130zin talebi olu\u015fturulurken hata olu\u015ftu")}},onCancel:()=>w(!1),okText:"Onayla",cancelText:"\u0130ptal",children:[(0,_.jsxs)("p",{children:[(0,_.jsx)("strong",{children:"\u0130zin T\xfcr\xfc:"})," ",null===(a=h.find((e=>e.id===S.leave_type_id)))||void 0===a?void 0:a.name]}),(0,_.jsxs)("p",{children:[(0,_.jsx)("strong",{children:"\u0130zin Tarihleri:"})," ",S.start_date&&S.end_date?`${p()(S.start_date).format("DD.MM.YYYY")} - ${p()(S.end_date).format("DD.MM.YYYY")}`:"Belirtilmemi\u015f"]}),(0,_.jsxs)("p",{children:[(0,_.jsx)("strong",{children:"Talep edilen izin g\xfcn say\u0131s\u0131:"})," ",k," g\xfcn"]}),(0,_.jsxs)("p",{children:[(0,_.jsx)("strong",{children:"\u0130\u015f g\xfcnleri:"})," ",b," g\xfcn"]}),(0,_.jsxs)("p",{children:[(0,_.jsx)("strong",{children:"\u0130zin Nedeni:"})," ",S.reason]})]})]})}}}]);